<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GreenDrop â€” Documentation Technique ComplÃ¨te</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');
    :root {
      --green: #22c55e; --green-dark: #16a34a; --green-light: #dcfce7;
      --blue: #3b82f6; --blue-light: #dbeafe;
      --orange: #f97316; --orange-light: #ffedd5;
      --red: #ef4444; --red-light: #fee2e2;
      --purple: #8b5cf6; --purple-light: #ede9fe;
      --cyan: #06b6d4; --cyan-light: #cffafe;
      --gray-50: #f9fafb; --gray-100: #f3f4f6; --gray-200: #e5e7eb;
      --gray-300: #d1d5db; --gray-500: #6b7280; --gray-700: #374151;
      --gray-800: #1f2937; --gray-900: #111827;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Inter', sans-serif; color: var(--gray-800); line-height: 1.7; background: #fff; font-size: 13px; }
    @media print {
      body { font-size: 10px; line-height: 1.4; }
      .page-break { page-break-before: always; }
      .no-print { display: none; }
      section { page-break-inside: avoid; }
      .diagram-box { page-break-inside: avoid; }
      h2 { page-break-after: avoid; }
    }
    .container { max-width: 1100px; margin: 0 auto; padding: 0 30px; }
    /* Cover */
    .cover { min-height: 100vh; display: flex; align-items: center; justify-content: center; background: linear-gradient(135deg, #065f46 0%, #059669 50%, #34d399 100%); color: #fff; text-align: center; }
    .cover h1 { font-size: 52px; font-weight: 800; margin-bottom: 10px; }
    .cover .subtitle { font-size: 22px; font-weight: 300; opacity: .85; margin-bottom: 30px; }
    .cover .meta { font-size: 14px; opacity: .7; }
    .cover .logo { width: 100px; height: 100px; background: rgba(255,255,255,.2); border-radius: 24px; margin: 0 auto 30px; display: flex; align-items: center; justify-content: center; font-size: 50px; }
    /* TOC */
    .toc { padding: 50px 0; }
    .toc h2 { font-size: 28px; margin-bottom: 20px; color: var(--green-dark); }
    .toc-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .toc-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 10px; background: var(--gray-50); border: 1px solid var(--gray-200); text-decoration: none; color: var(--gray-800); transition: .2s; }
    .toc-item:hover { background: var(--green-light); border-color: var(--green); }
    .toc-num { width: 32px; height: 32px; border-radius: 8px; background: var(--green); color: #fff; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 13px; flex-shrink: 0; }
    .toc-label { font-weight: 500; font-size: 14px; }
    /* Sections */
    section { padding: 40px 0; border-top: 2px solid var(--gray-100); }
    h2 { font-size: 26px; font-weight: 700; color: var(--green-dark); margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
    h2 .num { width: 36px; height: 36px; border-radius: 10px; background: var(--green); color: #fff; display: flex; align-items: center; justify-content: center; font-size: 15px; flex-shrink: 0; }
    h3 { font-size: 18px; font-weight: 600; margin: 24px 0 12px; color: var(--gray-900); }
    h4 { font-size: 14px; font-weight: 600; margin: 16px 0 8px; color: var(--gray-700); }
    p { margin-bottom: 12px; }
    /* Diagram */
    .diagram-box { background: var(--gray-50); border: 1px solid var(--gray-200); border-radius: 12px; padding: 24px; margin: 20px 0; overflow-x: auto; }
    .diagram-box .title { font-weight: 700; font-size: 14px; margin-bottom: 16px; text-align: center; color: var(--gray-700); }
    svg text { font-family: 'Inter', sans-serif; }
    /* Tables */
    table { width: 100%; border-collapse: collapse; margin: 16px 0; font-size: 12px; }
    th { background: var(--gray-100); font-weight: 600; text-align: left; padding: 10px 12px; border-bottom: 2px solid var(--gray-300); }
    td { padding: 8px 12px; border-bottom: 1px solid var(--gray-200); vertical-align: top; }
    tr:hover td { background: var(--gray-50); }
    /* Cards */
    .card-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 14px; margin: 16px 0; }
    .card { padding: 16px; border-radius: 10px; border: 1px solid var(--gray-200); background: #fff; }
    .card .card-title { font-weight: 600; font-size: 14px; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }
    .card .card-desc { font-size: 12px; color: var(--gray-500); }
    .card.green { border-color: var(--green); background: var(--green-light); }
    .card.blue { border-color: var(--blue); background: var(--blue-light); }
    .card.orange { border-color: var(--orange); background: var(--orange-light); }
    .card.purple { border-color: var(--purple); background: var(--purple-light); }
    .card.red { border-color: var(--red); background: var(--red-light); }
    .card.cyan { border-color: var(--cyan); background: var(--cyan-light); }
    /* Badge */
    .badge { display: inline-block; padding: 2px 10px; border-radius: 20px; font-size: 11px; font-weight: 600; }
    .badge.green { background: var(--green-light); color: var(--green-dark); }
    .badge.blue { background: var(--blue-light); color: #1d4ed8; }
    .badge.orange { background: var(--orange-light); color: #c2410c; }
    .badge.red { background: var(--red-light); color: #dc2626; }
    .badge.purple { background: var(--purple-light); color: #7c3aed; }
    /* Code */
    code { font-family: 'JetBrains Mono', monospace; font-size: 11px; background: var(--gray-100); padding: 2px 6px; border-radius: 4px; }
    pre { background: var(--gray-900); color: #e5e7eb; padding: 16px; border-radius: 10px; overflow-x: auto; margin: 12px 0; font-size: 11px; line-height: 1.6; }
    pre code { background: transparent; padding: 0; color: inherit; }
    /* Flow */
    .flow { display: flex; align-items: center; gap: 0; flex-wrap: wrap; margin: 16px 0; justify-content: center; }
    .flow-step { padding: 8px 16px; background: var(--green-light); border: 1px solid var(--green); border-radius: 8px; font-size: 12px; font-weight: 500; text-align: center; }
    .flow-arrow { font-size: 18px; color: var(--gray-500); padding: 0 6px; }
    .flow-step.blue { background: var(--blue-light); border-color: var(--blue); }
    .flow-step.orange { background: var(--orange-light); border-color: var(--orange); }
    .flow-step.purple { background: var(--purple-light); border-color: var(--purple); }
    .flow-step.red { background: var(--red-light); border-color: var(--red); }
    .flow-step.cyan { background: var(--cyan-light); border-color: var(--cyan); }
    /* Tech stack */
    .tech-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin: 16px 0; }
    .tech-item { text-align: center; padding: 12px; border-radius: 10px; background: var(--gray-50); border: 1px solid var(--gray-200); }
    .tech-item .name { font-weight: 600; font-size: 13px; }
    .tech-item .role { font-size: 11px; color: var(--gray-500); }
    /* Two cols */
    .two-cols { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 16px 0; }
    .col-full { grid-column: 1 / -1; }
  </style>
</head>
<body>

<!-- ========== COVER ========== -->
<div class="cover">
  <div>
    <div class="logo">ğŸŒ¿</div>
    <h1>GreenDrop</h1>
    <div class="subtitle">Documentation Technique ComplÃ¨te</div>
    <p style="font-size:16px; opacity:.8; max-width:600px; margin:0 auto 20px;">Plateforme de livraison CBD â€” Application Mobile iOS, Panel Admin Web, Cloud Functions Firebase</p>
    <div class="meta">Version 1.0 â€” FÃ©vrier 2026 â€” Projet RNCP</div>
  </div>
</div>

<!-- ========== TOC ========== -->
<div class="page-break"></div>
<div class="container toc">
  <h2>ğŸ“‘ Table des MatiÃ¨res</h2>
  <div class="toc-grid">
    <a href="#s1" class="toc-item"><span class="toc-num">1</span><span class="toc-label">Architecture GÃ©nÃ©rale</span></a>
    <a href="#s2" class="toc-item"><span class="toc-num">2</span><span class="toc-label">Stack Technique</span></a>
    <a href="#s3" class="toc-item"><span class="toc-num">3</span><span class="toc-label">Application Mobile iOS</span></a>
    <a href="#s4" class="toc-item"><span class="toc-num">4</span><span class="toc-label">Panel Admin Web</span></a>
    <a href="#s5" class="toc-item"><span class="toc-num">5</span><span class="toc-label">Cloud Functions Firebase</span></a>
    <a href="#s6" class="toc-item"><span class="toc-num">6</span><span class="toc-label">Base de DonnÃ©es Firestore</span></a>
    <a href="#s7" class="toc-item"><span class="toc-num">7</span><span class="toc-label">Flux de Paiement Stripe</span></a>
    <a href="#s8" class="toc-item"><span class="toc-num">8</span><span class="toc-label">SÃ©curitÃ© &amp; RÃ¨gles Firestore</span></a>
    <a href="#s9" class="toc-item"><span class="toc-num">9</span><span class="toc-label">Monitoring &amp; ObservabilitÃ©</span></a>
    <a href="#s10" class="toc-item"><span class="toc-num">10</span><span class="toc-label">CI/CD Pipeline</span></a>
    <a href="#s11" class="toc-item"><span class="toc-num">11</span><span class="toc-label">API REST Documentation</span></a>
    <a href="#s12" class="toc-item"><span class="toc-num">12</span><span class="toc-label">Variables d'Environnement</span></a>
  </div>
</div>

<!-- ========== SECTION 1: ARCHITECTURE ========== -->
<div class="page-break"></div>
<div class="container">
<section id="s1">
  <h2><span class="num">1</span> Architecture GÃ©nÃ©rale</h2>
  <p>GreenDrop est une plateforme complÃ¨te de livraison CBD composÃ©e de trois briques principales interconnectÃ©es via Firebase et une API REST hÃ©bergÃ©e sur Vercel.</p>

  <div class="diagram-box">
    <div class="title">Diagramme d'Architecture Globale</div>
    <svg viewBox="0 0 900 520" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:900px;margin:0 auto;display:block;">
      <!-- Mobile App -->
      <rect x="30" y="30" width="200" height="160" rx="14" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
      <text x="130" y="60" text-anchor="middle" font-size="14" font-weight="700" fill="#065f46">ğŸ“± Application Mobile</text>
      <text x="130" y="82" text-anchor="middle" font-size="11" fill="#374151">iOS â€” Swift / SwiftUI</text>
      <line x1="50" y1="95" x2="210" y2="95" stroke="#d1d5db" stroke-width="1"/>
      <text x="130" y="115" text-anchor="middle" font-size="10" fill="#6b7280">3 rÃ´les : Client</text>
      <text x="130" y="130" text-anchor="middle" font-size="10" fill="#6b7280">Driver Â· Merchant</text>
      <text x="130" y="150" text-anchor="middle" font-size="10" fill="#6b7280">~18 600 lignes Swift</text>
      <text x="130" y="170" text-anchor="middle" font-size="10" fill="#6b7280">MapKit Â· Stripe SDK</text>

      <!-- Admin Panel -->
      <rect x="350" y="30" width="200" height="160" rx="14" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
      <text x="450" y="60" text-anchor="middle" font-size="14" font-weight="700" fill="#1e3a8a">ğŸ–¥ï¸ Panel Admin</text>
      <text x="450" y="82" text-anchor="middle" font-size="11" fill="#374151">Next.js 16 Â· React 19</text>
      <line x1="370" y1="95" x2="530" y2="95" stroke="#d1d5db" stroke-width="1"/>
      <text x="450" y="115" text-anchor="middle" font-size="10" fill="#6b7280">Dashboard Â· Commandes</text>
      <text x="450" y="130" text-anchor="middle" font-size="10" fill="#6b7280">Drivers Â· Utilisateurs</text>
      <text x="450" y="150" text-anchor="middle" font-size="10" fill="#6b7280">VÃ©rifications KYC</text>
      <text x="450" y="170" text-anchor="middle" font-size="10" fill="#6b7280">Zones Â· Catalogue</text>

      <!-- Cloud Functions -->
      <rect x="670" y="30" width="200" height="160" rx="14" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
      <text x="770" y="60" text-anchor="middle" font-size="14" font-weight="700" fill="#4c1d95">âš¡ Cloud Functions</text>
      <text x="770" y="82" text-anchor="middle" font-size="11" fill="#374151">Firebase Functions v5</text>
      <line x1="690" y1="95" x2="850" y2="95" stroke="#d1d5db" stroke-width="1"/>
      <text x="770" y="115" text-anchor="middle" font-size="10" fill="#6b7280">22 fonctions dÃ©ployÃ©es</text>
      <text x="770" y="130" text-anchor="middle" font-size="10" fill="#6b7280">Triggers Firestore</text>
      <text x="770" y="150" text-anchor="middle" font-size="10" fill="#6b7280">Endpoints HTTPS</text>
      <text x="770" y="170" text-anchor="middle" font-size="10" fill="#6b7280">Scheduled (Cron)</text>

      <!-- Firebase -->
      <rect x="250" y="260" width="400" height="120" rx="14" fill="#ffedd5" stroke="#f97316" stroke-width="2"/>
      <text x="450" y="290" text-anchor="middle" font-size="15" font-weight="700" fill="#9a3412">ğŸ”¥ Firebase Platform</text>
      <line x1="270" y1="305" x2="630" y2="305" stroke="#d1d5db" stroke-width="1"/>
      <text x="330" y="328" text-anchor="middle" font-size="11" fill="#374151" font-weight="600">Auth</text>
      <text x="330" y="344" text-anchor="middle" font-size="9" fill="#6b7280">Email Â· Google</text>
      <text x="450" y="328" text-anchor="middle" font-size="11" fill="#374151" font-weight="600">Firestore</text>
      <text x="450" y="344" text-anchor="middle" font-size="9" fill="#6b7280">15 collections</text>
      <text x="450" y="358" text-anchor="middle" font-size="9" fill="#6b7280">Real-time listeners</text>
      <text x="570" y="328" text-anchor="middle" font-size="11" fill="#374151" font-weight="600">Storage</text>
      <text x="570" y="344" text-anchor="middle" font-size="9" fill="#6b7280">Images Â· KYC docs</text>

      <!-- External Services -->
      <rect x="30" y="430" width="160" height="70" rx="10" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
      <text x="110" y="460" text-anchor="middle" font-size="12" font-weight="600" fill="#991b1b">ğŸ’³ Stripe</text>
      <text x="110" y="478" text-anchor="middle" font-size="9" fill="#6b7280">Paiements Â· Connect</text>

      <rect x="220" y="430" width="160" height="70" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
      <text x="300" y="460" text-anchor="middle" font-size="12" font-weight="600" fill="#92400e">ğŸ“Š Grafana Cloud</text>
      <text x="300" y="478" text-anchor="middle" font-size="9" fill="#6b7280">MÃ©triques Â· Alertes</text>

      <rect x="410" y="430" width="160" height="70" rx="10" fill="#fce7f3" stroke="#ec4899" stroke-width="1.5"/>
      <text x="490" y="460" text-anchor="middle" font-size="12" font-weight="600" fill="#9d174d">ğŸ› Sentry</text>
      <text x="490" y="478" text-anchor="middle" font-size="9" fill="#6b7280">Error Tracking</text>

      <rect x="600" y="430" width="160" height="70" rx="10" fill="#cffafe" stroke="#06b6d4" stroke-width="1.5"/>
      <text x="680" y="460" text-anchor="middle" font-size="12" font-weight="600" fill="#155e75">â–² Vercel</text>
      <text x="680" y="478" text-anchor="middle" font-size="9" fill="#6b7280">Hosting Â· API Routes</text>

      <!-- Arrows -->
      <defs><marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <!-- Mobile -> Firebase -->
      <path d="M130 190 L130 220 Q130 240 150 240 L320 240 Q340 240 340 260" stroke="#6b7280" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
      <!-- Admin -> Firebase -->
      <line x1="450" y1="190" x2="450" y2="255" stroke="#6b7280" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
      <!-- Functions -> Firebase -->
      <path d="M770 190 L770 220 Q770 240 750 240 L560 240 Q540 240 540 260" stroke="#6b7280" stroke-width="1.5" fill="none" marker-end="url(#arrow)"/>
      <!-- Firebase -> External -->
      <line x1="350" y1="380" x2="110" y2="425" stroke="#6b7280" stroke-width="1" stroke-dasharray="4" marker-end="url(#arrow)"/>
      <line x1="400" y1="380" x2="300" y2="425" stroke="#6b7280" stroke-width="1" stroke-dasharray="4" marker-end="url(#arrow)"/>
      <line x1="470" y1="380" x2="490" y2="425" stroke="#6b7280" stroke-width="1" stroke-dasharray="4" marker-end="url(#arrow)"/>
      <line x1="550" y1="380" x2="680" y2="425" stroke="#6b7280" stroke-width="1" stroke-dasharray="4" marker-end="url(#arrow)"/>
    </svg>
  </div>

  <h3>Structure du Monorepo</h3>
  <div class="diagram-box">
    <div class="title">Organisation des RÃ©pertoires</div>
    <svg viewBox="0 0 800 300" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:800px;margin:0 auto;display:block;">
      <!-- Root -->
      <rect x="300" y="10" width="200" height="40" rx="8" fill="#f3f4f6" stroke="#374151" stroke-width="2"/>
      <text x="400" y="35" text-anchor="middle" font-size="13" font-weight="700" fill="#111827">greendrop/</text>
      <!-- Branches -->
      <line x1="400" y1="50" x2="400" y2="70" stroke="#374151" stroke-width="1.5"/>
      <line x1="130" y1="70" x2="670" y2="70" stroke="#374151" stroke-width="1.5"/>
      <line x1="130" y1="70" x2="130" y2="90" stroke="#374151" stroke-width="1.5"/>
      <line x1="400" y1="70" x2="400" y2="90" stroke="#374151" stroke-width="1.5"/>
      <line x1="670" y1="70" x2="670" y2="90" stroke="#374151" stroke-width="1.5"/>
      <!-- Admin -->
      <rect x="30" y="90" width="200" height="190" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="130" y="115" text-anchor="middle" font-size="13" font-weight="700" fill="#1e3a8a">admin/</text>
      <text x="50" y="138" font-size="10" fill="#374151">â”œâ”€â”€ app/ (pages + API routes)</text>
      <text x="50" y="155" font-size="10" fill="#374151">â”œâ”€â”€ components/ (UI + admin)</text>
      <text x="50" y="172" font-size="10" fill="#374151">â”œâ”€â”€ hooks/ (14 custom hooks)</text>
      <text x="50" y="189" font-size="10" fill="#374151">â”œâ”€â”€ lib/ (firebase, stripe, utils)</text>
      <text x="50" y="206" font-size="10" fill="#374151">â”œâ”€â”€ public/ (assets, docs)</text>
      <text x="50" y="223" font-size="10" fill="#374151">â”œâ”€â”€ next.config.ts</text>
      <text x="50" y="240" font-size="10" fill="#374151">â””â”€â”€ pnpm-lock.yaml</text>
      <!-- Shared -->
      <rect x="300" y="90" width="200" height="190" rx="10" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="400" y="115" text-anchor="middle" font-size="13" font-weight="700" fill="#4c1d95">shared/</text>
      <text x="320" y="138" font-size="10" fill="#374151">â”œâ”€â”€ functions/</text>
      <text x="320" y="155" font-size="10" fill="#374151">â”‚   â”œâ”€â”€ src/endpoints/</text>
      <text x="320" y="172" font-size="10" fill="#374151">â”‚   â”œâ”€â”€ src/triggers/</text>
      <text x="320" y="189" font-size="10" fill="#374151">â”‚   â””â”€â”€ src/index.ts</text>
      <text x="320" y="206" font-size="10" fill="#374151">â”œâ”€â”€ firestore.rules</text>
      <text x="320" y="223" font-size="10" fill="#374151">â”œâ”€â”€ firestore.indexes.json</text>
      <text x="320" y="240" font-size="10" fill="#374151">â””â”€â”€ grafana/dashboard.json</text>
      <!-- Mobile -->
      <rect x="570" y="90" width="200" height="190" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="670" y="115" text-anchor="middle" font-size="13" font-weight="700" fill="#065f46">mobile/</text>
      <text x="590" y="138" font-size="10" fill="#374151">â”œâ”€â”€ GreenDrop/</text>
      <text x="590" y="155" font-size="10" fill="#374151">â”‚   â”œâ”€â”€ Models.swift</text>
      <text x="590" y="172" font-size="10" fill="#374151">â”‚   â”œâ”€â”€ Services.swift</text>
      <text x="590" y="189" font-size="10" fill="#374151">â”‚   â”œâ”€â”€ ClientViews.swift</text>
      <text x="590" y="206" font-size="10" fill="#374151">â”‚   â”œâ”€â”€ DriverViews.swift</text>
      <text x="590" y="223" font-size="10" fill="#374151">â”‚   â”œâ”€â”€ MerchantViews.swift</text>
      <text x="590" y="240" font-size="10" fill="#374151">â”‚   â””â”€â”€ +12 fichiers Swift</text>
    </svg>
  </div>
</section>

<!-- ========== SECTION 2: STACK TECHNIQUE ========== -->
<section id="s2">
  <h2><span class="num">2</span> Stack Technique</h2>

  <h3>Application Mobile iOS</h3>
  <div class="tech-grid">
    <div class="tech-item"><div class="name">Swift 5.9+</div><div class="role">Langage</div></div>
    <div class="tech-item"><div class="name">SwiftUI</div><div class="role">Framework UI</div></div>
    <div class="tech-item"><div class="name">Firebase iOS SDK</div><div class="role">Auth Â· Firestore Â· Storage</div></div>
    <div class="tech-item"><div class="name">Stripe PaymentSheet</div><div class="role">Paiements</div></div>
    <div class="tech-item"><div class="name">MapKit</div><div class="role">Cartographie</div></div>
    <div class="tech-item"><div class="name">Google Sign-In</div><div class="role">OAuth</div></div>
    <div class="tech-item"><div class="name">Kingfisher</div><div class="role">Chargement images</div></div>
    <div class="tech-item"><div class="name">CoreLocation</div><div class="role">GPS temps rÃ©el</div></div>
    <div class="tech-item"><div class="name">Crashlytics</div><div class="role">Crash reporting</div></div>
  </div>

  <h3>Panel Admin Web</h3>
  <div class="tech-grid">
    <div class="tech-item"><div class="name">Next.js 16</div><div class="role">Framework React</div></div>
    <div class="tech-item"><div class="name">React 19</div><div class="role">UI Library</div></div>
    <div class="tech-item"><div class="name">TypeScript 5</div><div class="role">Typage statique</div></div>
    <div class="tech-item"><div class="name">Tailwind CSS 4</div><div class="role">Styling</div></div>
    <div class="tech-item"><div class="name">shadcn/ui</div><div class="role">Composants UI</div></div>
    <div class="tech-item"><div class="name">MapLibre GL</div><div class="role">Cartographie</div></div>
    <div class="tech-item"><div class="name">Recharts</div><div class="role">Graphiques</div></div>
    <div class="tech-item"><div class="name">Stripe API</div><div class="role">Paiements</div></div>
    <div class="tech-item"><div class="name">Sentry</div><div class="role">Error tracking</div></div>
  </div>

  <h3>Backend &amp; Infrastructure</h3>
  <div class="tech-grid">
    <div class="tech-item"><div class="name">Firebase Functions v5</div><div class="role">Serverless backend</div></div>
    <div class="tech-item"><div class="name">Firestore</div><div class="role">Base de donnÃ©es NoSQL</div></div>
    <div class="tech-item"><div class="name">Firebase Auth</div><div class="role">Authentification</div></div>
    <div class="tech-item"><div class="name">Firebase Storage</div><div class="role">Fichiers &amp; images</div></div>
    <div class="tech-item"><div class="name">Vercel</div><div class="role">Hosting Admin</div></div>
    <div class="tech-item"><div class="name">Grafana Cloud</div><div class="role">Monitoring mÃ©triques</div></div>
    <div class="tech-item"><div class="name">GitHub Actions</div><div class="role">CI/CD</div></div>
    <div class="tech-item"><div class="name">pnpm</div><div class="role">Package manager</div></div>
    <div class="tech-item"><div class="name">Vitest</div><div class="role">Tests unitaires</div></div>
  </div>
</section>

<!-- ========== SECTION 3: MOBILE APP ========== -->
<div class="page-break"></div>
<section id="s3">
  <h2><span class="num">3</span> Application Mobile iOS</h2>
  <p>Application native iOS dÃ©veloppÃ©e en Swift/SwiftUI, supportant trois rÃ´les utilisateur distincts avec des interfaces dÃ©diÃ©es. ~18 600 lignes de code.</p>

  <h3>Navigation par RÃ´le</h3>
  <div class="diagram-box">
    <div class="title">Routage de l'Application Mobile</div>
    <svg viewBox="0 0 860 440" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:860px;margin:0 auto;display:block;">
      <defs><marker id="a2" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <!-- Entry -->
      <rect x="330" y="10" width="200" height="40" rx="8" fill="#f3f4f6" stroke="#374151" stroke-width="2"/>
      <text x="430" y="35" text-anchor="middle" font-size="13" font-weight="700" fill="#111827">GreenDropApp</text>
      <line x1="430" y1="50" x2="430" y2="70" stroke="#374151" stroke-width="1.5" marker-end="url(#a2)"/>
      <!-- Auth Check -->
      <rect x="330" y="75" width="200" height="36" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
      <text x="430" y="98" text-anchor="middle" font-size="11" font-weight="600" fill="#92400e">AuthentifiÃ© ?</text>
      <!-- No -->
      <path d="M330 93 L230 93" stroke="#ef4444" stroke-width="1.5" marker-end="url(#a2)"/>
      <text x="280" y="87" text-anchor="middle" font-size="9" fill="#ef4444" font-weight="600">Non</text>
      <rect x="100" y="75" width="130" height="36" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
      <text x="165" y="98" text-anchor="middle" font-size="11" font-weight="600" fill="#991b1b">LoginView</text>
      <!-- Yes -->
      <line x1="430" y1="111" x2="430" y2="135" stroke="#22c55e" stroke-width="1.5" marker-end="url(#a2)"/>
      <text x="445" y="128" font-size="9" fill="#22c55e" font-weight="600">Oui</text>
      <!-- Role Check -->
      <rect x="330" y="140" width="200" height="36" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="430" y="163" text-anchor="middle" font-size="11" font-weight="600" fill="#4c1d95">userProfile.role ?</text>
      <!-- 3 branches -->
      <line x1="330" y1="158" x2="130" y2="158" stroke="#374151" stroke-width="1"/>
      <line x1="130" y1="158" x2="130" y2="200" stroke="#374151" stroke-width="1" marker-end="url(#a2)"/>
      <line x1="430" y1="176" x2="430" y2="200" stroke="#374151" stroke-width="1" marker-end="url(#a2)"/>
      <line x1="530" y1="158" x2="730" y2="158" stroke="#374151" stroke-width="1"/>
      <line x1="730" y1="158" x2="730" y2="200" stroke="#374151" stroke-width="1" marker-end="url(#a2)"/>
      <!-- Client -->
      <rect x="20" y="205" width="220" height="220" rx="12" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
      <text x="130" y="228" text-anchor="middle" font-size="13" font-weight="700" fill="#065f46">Client (user)</text>
      <line x1="40" y1="238" x2="220" y2="238" stroke="#bbf7d0" stroke-width="1"/>
      <text x="40" y="258" font-size="10" fill="#374151">ğŸ  Accueil â€” Boutiques</text>
      <text x="40" y="278" font-size="10" fill="#374151">â¤ï¸ Favoris</text>
      <text x="40" y="298" font-size="10" fill="#374151">ğŸ“¦ Commandes &amp; Suivi</text>
      <text x="40" y="318" font-size="10" fill="#374151">ğŸ›’ Panier &amp; Checkout</text>
      <text x="40" y="338" font-size="10" fill="#374151">ğŸ‘¤ Profil &amp; ParamÃ¨tres</text>
      <text x="40" y="358" font-size="10" fill="#6b7280">Filtres Â· Carte Â· KYC</text>
      <text x="40" y="378" font-size="10" fill="#6b7280">Promos Â· Pourboires</text>
      <text x="40" y="398" font-size="10" fill="#6b7280">Chat Â· Notes Â· Adresses</text>
      <!-- Driver -->
      <rect x="320" y="205" width="220" height="220" rx="12" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
      <text x="430" y="228" text-anchor="middle" font-size="13" font-weight="700" fill="#1e3a8a">Chauffeur (driver)</text>
      <line x1="340" y1="238" x2="520" y2="238" stroke="#bfdbfe" stroke-width="1"/>
      <text x="340" y="258" font-size="10" fill="#374151">ğŸ“Š Dashboard â€” Stats</text>
      <text x="340" y="278" font-size="10" fill="#374151">ğŸ”„ Online/Offline Toggle</text>
      <text x="340" y="298" font-size="10" fill="#374151">ğŸ“ Livraisons disponibles</text>
      <text x="340" y="318" font-size="10" fill="#374151">ğŸ—ºï¸ Navigation MapKit</text>
      <text x="340" y="338" font-size="10" fill="#374151">ğŸ‘¤ Profil &amp; Stripe Connect</text>
      <text x="340" y="358" font-size="10" fill="#6b7280">GPS temps rÃ©el (10s)</text>
      <text x="340" y="378" font-size="10" fill="#6b7280">Historique livraisons</text>
      <text x="340" y="398" font-size="10" fill="#6b7280">Gains Â· Pourboires</text>
      <!-- Merchant -->
      <rect x="620" y="205" width="220" height="220" rx="12" fill="#ffedd5" stroke="#f97316" stroke-width="2"/>
      <text x="730" y="228" text-anchor="middle" font-size="13" font-weight="700" fill="#9a3412">Marchand (merchant)</text>
      <line x1="640" y1="238" x2="820" y2="238" stroke="#fed7aa" stroke-width="1"/>
      <text x="640" y="258" font-size="10" fill="#374151">ğŸ“Š Dashboard â€” CA &amp; Stats</text>
      <text x="640" y="278" font-size="10" fill="#374151">ğŸ“¦ Gestion commandes</text>
      <text x="640" y="298" font-size="10" fill="#374151">ğŸ·ï¸ Catalogue produits</text>
      <text x="640" y="318" font-size="10" fill="#374151">âš™ï¸ ParamÃ¨tres boutique</text>
      <text x="640" y="338" font-size="10" fill="#374151">ğŸ‘¤ Profil &amp; Stripe Connect</text>
      <text x="640" y="358" font-size="10" fill="#6b7280">CRUD produits</text>
      <text x="640" y="378" font-size="10" fill="#6b7280">Graphiques revenus</text>
      <text x="640" y="398" font-size="10" fill="#6b7280">Ouvert/FermÃ© toggle</text>
    </svg>
  </div>

  <h3>Fichiers Sources Mobile</h3>
  <table>
    <thead><tr><th>Fichier</th><th>Lignes</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>GreenDropApp.swift</code></td><td>906</td><td>Point d'entrÃ©e, AppState, routage par rÃ´le</td></tr>
      <tr><td><code>Models.swift</code></td><td>530</td><td>ModÃ¨les : Shop, Product, Order, Delivery, Statistics</td></tr>
      <tr><td><code>Services.swift</code></td><td>3 206</td><td>AuthService, DataService, CartManager, LocationManager, NotificationService, FavoritesManager, ReviewManager, AddressManager, PromoCodeManager, TipManager</td></tr>
      <tr><td><code>APIService.swift</code></td><td>449</td><td>Client REST vers <code>greendrop-one.vercel.app/api</code></td></tr>
      <tr><td><code>PaymentService.swift</code></td><td>393</td><td>IntÃ©gration Stripe PaymentSheet &amp; Connect</td></tr>
      <tr><td><code>ClientViews.swift</code></td><td>3 375</td><td>Home, Shop detail, Panier, Commandes, Favoris, Profil</td></tr>
      <tr><td><code>DriverViews.swift</code></td><td>1 289</td><td>Dashboard, Livraisons, Navigation, Gains</td></tr>
      <tr><td><code>MerchantViews.swift</code></td><td>1 415</td><td>Dashboard, Commandes, Produits, ParamÃ¨tres boutique</td></tr>
      <tr><td><code>LoginView.swift</code></td><td>696</td><td>Email/password, Google Sign-In, comptes dÃ©mo</td></tr>
      <tr><td><code>ChatViews.swift</code></td><td>640</td><td>Messagerie intÃ©grÃ©e par commande</td></tr>
      <tr><td><code>KYCViews.swift</code></td><td>1 034</td><td>VÃ©rification d'Ã¢ge : document + selfie</td></tr>
      <tr><td><code>DeliveryProofViews.swift</code></td><td>721</td><td>Preuve de livraison photo</td></tr>
      <tr><td><code>MapViews.swift</code></td><td>709</td><td>Carte des boutiques et suivi GPS</td></tr>
      <tr><td><code>RatingViews.swift</code></td><td>731</td><td>SystÃ¨me d'avis et notation</td></tr>
      <tr><td><code>PromoCodeViews.swift</code></td><td>579</td><td>Codes promo</td></tr>
      <tr><td><code>TippingViews.swift</code></td><td>599</td><td>Pourboires</td></tr>
      <tr><td><code>SettingsViews.swift</code></td><td>1 337</td><td>PrÃ©fÃ©rences, langue, thÃ¨me, FAQ</td></tr>
    </tbody>
  </table>

  <h3>Gestion d'Ã‰tat (State Management)</h3>
  <div class="diagram-box">
    <div class="title">Pattern MVVM RÃ©actif avec Combine</div>
    <svg viewBox="0 0 800 260" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:800px;margin:0 auto;display:block;">
      <defs><marker id="a3" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <!-- Firestore -->
      <rect x="20" y="100" width="140" height="60" rx="10" fill="#ffedd5" stroke="#f97316" stroke-width="1.5"/>
      <text x="90" y="125" text-anchor="middle" font-size="12" font-weight="600" fill="#9a3412">Firestore</text>
      <text x="90" y="142" text-anchor="middle" font-size="9" fill="#6b7280">Real-time listeners</text>
      <!-- Services -->
      <rect x="220" y="60" width="180" height="140" rx="10" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="310" y="85" text-anchor="middle" font-size="12" font-weight="700" fill="#4c1d95">Services (@Published)</text>
      <line x1="240" y1="95" x2="380" y2="95" stroke="#d1d5db" stroke-width="1"/>
      <text x="240" y="115" font-size="10" fill="#374151">AuthService</text>
      <text x="240" y="132" font-size="10" fill="#374151">DataService</text>
      <text x="240" y="149" font-size="10" fill="#374151">CartManager</text>
      <text x="240" y="166" font-size="10" fill="#374151">LocationManager</text>
      <text x="240" y="183" font-size="10" fill="#374151">+6 Managers</text>
      <!-- Views -->
      <rect x="460" y="60" width="160" height="140" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="540" y="85" text-anchor="middle" font-size="12" font-weight="700" fill="#065f46">SwiftUI Views</text>
      <line x1="480" y1="95" x2="600" y2="95" stroke="#d1d5db" stroke-width="1"/>
      <text x="480" y="115" font-size="10" fill="#374151">@EnvironmentObject</text>
      <text x="480" y="132" font-size="10" fill="#374151">@StateObject</text>
      <text x="480" y="149" font-size="10" fill="#374151">@Published â†’ auto</text>
      <text x="480" y="166" font-size="10" fill="#374151">re-render on change</text>
      <!-- User -->
      <rect x="680" y="100" width="100" height="60" rx="10" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
      <text x="730" y="125" text-anchor="middle" font-size="12" font-weight="600" fill="#991b1b">Utilisateur</text>
      <text x="730" y="142" text-anchor="middle" font-size="9" fill="#6b7280">Interactions</text>
      <!-- Arrows -->
      <line x1="160" y1="130" x2="215" y2="130" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a3)"/>
      <text x="188" y="123" text-anchor="middle" font-size="8" fill="#6b7280">sync</text>
      <line x1="400" y1="130" x2="455" y2="130" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a3)"/>
      <text x="428" y="123" text-anchor="middle" font-size="8" fill="#6b7280">bind</text>
      <line x1="620" y1="130" x2="675" y2="130" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a3)"/>
      <path d="M680 145 L640 145 Q630 145 630 155 L630 230 Q630 240 620 240 L310 240 Q300 240 300 230 L300 205" stroke="#6b7280" stroke-width="1" stroke-dasharray="4" marker-end="url(#a3)"/>
      <text x="480" y="248" text-anchor="middle" font-size="8" fill="#6b7280">action â†’ Service method â†’ Firestore write</text>
    </svg>
  </div>

  <h3>Flux de Commande Client</h3>
  <div class="flow">
    <div class="flow-step">Parcourir boutiques</div><span class="flow-arrow">â†’</span>
    <div class="flow-step">Ajouter au panier</div><span class="flow-arrow">â†’</span>
    <div class="flow-step blue">VÃ©rification KYC</div><span class="flow-arrow">â†’</span>
    <div class="flow-step orange">Paiement Stripe</div><span class="flow-arrow">â†’</span>
    <div class="flow-step purple">Commande crÃ©Ã©e</div><span class="flow-arrow">â†’</span>
    <div class="flow-step cyan">Suivi temps rÃ©el</div><span class="flow-arrow">â†’</span>
    <div class="flow-step">LivrÃ© + Avis</div>
  </div>

  <h3>Flux Chauffeur</h3>
  <div class="flow">
    <div class="flow-step blue">Toggle Online</div><span class="flow-arrow">â†’</span>
    <div class="flow-step blue">Voir livraisons dispo</div><span class="flow-arrow">â†’</span>
    <div class="flow-step orange">Accepter livraison</div><span class="flow-arrow">â†’</span>
    <div class="flow-step">Naviguer â†’ Boutique</div><span class="flow-arrow">â†’</span>
    <div class="flow-step purple">RÃ©cupÃ©rer colis</div><span class="flow-arrow">â†’</span>
    <div class="flow-step cyan">Naviguer â†’ Client</div><span class="flow-arrow">â†’</span>
    <div class="flow-step">Confirmer + Photo</div>
  </div>

  <h3>Comptes de Test</h3>
  <table>
    <thead><tr><th>RÃ´le</th><th>Email</th><th>Mot de passe</th></tr></thead>
    <tbody>
      <tr><td><span class="badge green">Client</span></td><td><code>client1@pec5a.com</code></td><td><code>client123</code></td></tr>
      <tr><td><span class="badge blue">Driver</span></td><td><code>driver1@pec5a.com</code></td><td><code>driver123</code></td></tr>
      <tr><td><span class="badge orange">Merchant</span></td><td><code>merchant1@pec5a.com</code></td><td><code>merchant123</code></td></tr>
    </tbody>
  </table>
</section>

<!-- ========== SECTION 4: ADMIN ========== -->
<div class="page-break"></div>
<section id="s4">
  <h2><span class="num">4</span> Panel Admin Web</h2>
  <p>Application web Next.js 16 hÃ©bergÃ©e sur Vercel avec 13 pages principales (dont /monitoring), 14 API routes, et 14 hooks custom pour la gestion complÃ¨te de la plateforme.</p>

  <h3>Pages &amp; FonctionnalitÃ©s</h3>
  <div class="diagram-box">
    <div class="title">Plan du Site Admin</div>
    <svg viewBox="0 0 860 400" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:860px;margin:0 auto;display:block;">
      <defs><marker id="a4" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <!-- Sidebar -->
      <rect x="20" y="20" width="140" height="360" rx="10" fill="#1f2937" stroke="#374151" stroke-width="1"/>
      <text x="90" y="48" text-anchor="middle" font-size="12" font-weight="700" fill="#fff">ğŸŒ¿ Sidebar</text>
      <line x1="35" y1="58" x2="145" y2="58" stroke="#374151" stroke-width="1"/>
      <rect x="35" y="68" width="110" height="24" rx="4" fill="#22c55e"/>
      <text x="90" y="84" text-anchor="middle" font-size="10" fill="#fff">Dashboard</text>
      <rect x="35" y="98" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="114" text-anchor="middle" font-size="10" fill="#d1d5db">Commandes</text>
      <rect x="35" y="128" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="144" text-anchor="middle" font-size="10" fill="#d1d5db">Chauffeurs</text>
      <rect x="35" y="158" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="174" text-anchor="middle" font-size="10" fill="#d1d5db">Utilisateurs</text>
      <rect x="35" y="188" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="204" text-anchor="middle" font-size="10" fill="#d1d5db">Catalogue</text>
      <rect x="35" y="218" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="234" text-anchor="middle" font-size="10" fill="#d1d5db">Zones LÃ©gales</text>
      <rect x="35" y="248" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="264" text-anchor="middle" font-size="10" fill="#d1d5db">VÃ©rifications</text>
      <rect x="35" y="278" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="294" text-anchor="middle" font-size="10" fill="#d1d5db">Litiges</text>
      <rect x="35" y="308" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="324" text-anchor="middle" font-size="10" fill="#d1d5db">Chat</text>
      <rect x="35" y="338" width="110" height="24" rx="4" fill="#374151"/>
      <text x="90" y="354" text-anchor="middle" font-size="10" fill="#d1d5db">Monitoring</text>
      <!-- Pages detail -->
      <rect x="190" y="20" width="310" height="170" rx="10" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="345" y="45" text-anchor="middle" font-size="13" font-weight="700" fill="#065f46">/dashboard</text>
      <text x="210" y="68" font-size="10" fill="#374151">â€¢ KPI : CA, utilisateurs, vÃ©rifications</text>
      <text x="210" y="85" font-size="10" fill="#374151">â€¢ Graphique d'activitÃ© (Recharts)</text>
      <text x="210" y="102" font-size="10" fill="#374151">â€¢ Commandes en attente / livrÃ©es</text>
      <text x="210" y="119" font-size="10" fill="#374151">â€¢ Taux livraison Ã  l'heure</text>
      <text x="210" y="136" font-size="10" fill="#374151">â€¢ Drivers actifs &amp; en ligne</text>
      <text x="210" y="153" font-size="10" fill="#374151">â€¢ Journal d'activitÃ© rÃ©cent</text>
      <text x="210" y="170" font-size="10" fill="#374151">â€¢ Alertes retards &amp; litiges ouverts</text>

      <rect x="530" y="20" width="310" height="170" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="685" y="45" text-anchor="middle" font-size="13" font-weight="700" fill="#1e3a8a">/orders</text>
      <text x="550" y="68" font-size="10" fill="#374151">â€¢ Vue tableau avec tri &amp; filtres</text>
      <text x="550" y="85" font-size="10" fill="#374151">â€¢ Vue Kanban (dispatch board)</text>
      <text x="550" y="102" font-size="10" fill="#374151">â€¢ DÃ©tail commande + timeline</text>
      <text x="550" y="119" font-size="10" fill="#374151">â€¢ Assignation chauffeur</text>
      <text x="550" y="136" font-size="10" fill="#374151">â€¢ Mise Ã  jour statut</text>
      <text x="550" y="153" font-size="10" fill="#374151">â€¢ Contact client</text>
      <text x="550" y="170" font-size="10" fill="#374151">â€¢ Export CSV</text>

      <rect x="190" y="210" width="310" height="170" rx="10" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="345" y="235" text-anchor="middle" font-size="13" font-weight="700" fill="#4c1d95">/drivers</text>
      <text x="210" y="258" font-size="10" fill="#374151">â€¢ Carte temps rÃ©el (MapLibre GL)</text>
      <text x="210" y="275" font-size="10" fill="#374151">â€¢ Liste chauffeurs + statuts</text>
      <text x="210" y="292" font-size="10" fill="#374151">â€¢ Online / Offline / Busy / Break</text>
      <text x="210" y="309" font-size="10" fill="#374151">â€¢ VÃ©hicule, note, livraisons</text>
      <text x="210" y="326" font-size="10" fill="#374151">â€¢ LibÃ©rer d'une commande</text>
      <text x="210" y="343" font-size="10" fill="#374151">â€¢ Mode simulation dÃ©mo</text>
      <text x="210" y="360" font-size="10" fill="#374151">â€¢ CrÃ©er nouveau chauffeur</text>

      <rect x="530" y="210" width="310" height="170" rx="10" fill="#ffedd5" stroke="#f97316" stroke-width="1.5"/>
      <text x="685" y="235" text-anchor="middle" font-size="13" font-weight="700" fill="#9a3412">/verifications</text>
      <text x="550" y="258" font-size="10" fill="#374151">â€¢ Demandes KYC en attente</text>
      <text x="550" y="275" font-size="10" fill="#374151">â€¢ Documents : ID, permis, business</text>
      <text x="550" y="292" font-size="10" fill="#374151">â€¢ Approuver / Rejeter</text>
      <text x="550" y="309" font-size="10" fill="#374151">â€¢ Historique vÃ©rifications</text>
      <text x="550" y="326" font-size="10" fill="#374151">â€¢ PiÃ¨ces jointes</text>
      <text x="550" y="343" font-size="10" fill="#374151">â€¢ Motif de rejet</text>
      <text x="550" y="360" font-size="10" fill="#374151">â€¢ Infos KYC : nom, DOB, doc</text>
    </svg>
  </div>

  <h3>Autres Pages</h3>
  <div class="card-grid">
    <div class="card green"><div class="card-title">/users</div><div class="card-desc">Gestion utilisateurs : CRUD, rÃ´les (admin, supervisor, merchant, driver, user), statuts, export RGPD, recherche, actions groupÃ©es</div></div>
    <div class="card blue"><div class="card-title">/catalog</div><div class="card-desc">Produits : SKU, prix, stock, statut. Marchands : approbation, contacts, catÃ©gories. Import CSV.</div></div>
    <div class="card orange"><div class="card-title">/legal-zones</div><div class="card-desc">Ã‰diteur de zones sur carte MapLibre : dessin polygones, import/export GeoJSON, zones livraison &amp; restreintes</div></div>
    <div class="card purple"><div class="card-title">/disputes</div><div class="card-desc">Litiges : open â†’ investigating â†’ resolved â†’ closed. PrioritÃ©, montant, rÃ©solution, lien commande</div></div>
    <div class="card cyan"><div class="card-title">/chat</div><div class="card-desc">Messagerie temps rÃ©el par commande entre admin, chauffeurs et clients</div></div>
    <div class="card"><div class="card-title">/config</div><div class="card-desc">Feature flags, mode maintenance, paramÃ¨tres livraison (frais, rayon), paramÃ¨tres paiement (devise, TVA)</div></div>
    <div class="card red"><div class="card-title">/monitoring</div><div class="card-desc">5 dashboards Grafana (KPIs, Ops, Admin, Mobile, Funnel). Liens directs vers les dashboards publics. Alertes Discord.</div></div>
  </div>

  <h3>Hooks Custom</h3>
  <table>
    <thead><tr><th>Hook</th><th>RÃ´le</th></tr></thead>
    <tbody>
      <tr><td><code>use-orders</code></td><td>CRUD commandes, filtrage par statut, listeners temps rÃ©el</td></tr>
      <tr><td><code>use-drivers</code></td><td>Gestion flotte, statuts, localisation GPS</td></tr>
      <tr><td><code>use-users</code></td><td>CRUD utilisateurs, rÃ´les, export RGPD</td></tr>
      <tr><td><code>use-products</code></td><td>Catalogue produits, stock</td></tr>
      <tr><td><code>use-merchants</code></td><td>Gestion marchands, approbation</td></tr>
      <tr><td><code>use-verifications</code></td><td>Workflow KYC (approve/reject)</td></tr>
      <tr><td><code>use-disputes</code></td><td>RÃ©solution litiges</td></tr>
      <tr><td><code>use-legal-zones</code></td><td>Zones de livraison, GeoJSON</td></tr>
      <tr><td><code>use-chat</code></td><td>Messagerie temps rÃ©el</td></tr>
      <tr><td><code>use-notifications</code></td><td>Centre de notifications</td></tr>
      <tr><td><code>use-activity-logs</code></td><td>Journal d'activitÃ©</td></tr>
      <tr><td><code>use-dashboard-stats</code></td><td>AgrÃ©gation KPIs dashboard</td></tr>
      <tr><td><code>use-app-config</code></td><td>Feature flags &amp; configuration</td></tr>
    </tbody>
  </table>
</section>

<!-- ========== SECTION 5: CLOUD FUNCTIONS ========== -->
<div class="page-break"></div>
<section id="s5">
  <h2><span class="num">5</span> Cloud Functions Firebase</h2>
  <p>22 fonctions dÃ©ployÃ©es sur Firebase Cloud Functions v5, rÃ©parties en 4 catÃ©gories : Endpoints HTTPS (12), Triggers Firestore (7), et Scheduled (3).</p>

  <h3>Vue d'Ensemble des Fonctions</h3>
  <div class="diagram-box">
    <div class="title">Architecture Cloud Functions</div>
    <svg viewBox="0 0 860 480" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:860px;margin:0 auto;display:block;">
      <defs><marker id="a5" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <!-- HTTPS Endpoints -->
      <rect x="20" y="20" width="280" height="370" rx="12" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
      <text x="160" y="48" text-anchor="middle" font-size="14" font-weight="700" fill="#1e3a8a">Endpoints HTTPS (12)</text>
      <line x1="40" y1="58" x2="280" y2="58" stroke="#bfdbfe" stroke-width="1"/>
      <text x="40" y="78" font-size="10" font-weight="600" fill="#374151">Commandes</text>
      <text x="50" y="95" font-size="10" fill="#6b7280">â€¢ createOrder</text>
      <text x="50" y="110" font-size="10" fill="#6b7280">â€¢ updateOrderStatus</text>
      <text x="50" y="125" font-size="10" fill="#6b7280">â€¢ getMyOrders</text>
      <text x="50" y="140" font-size="10" fill="#6b7280">â€¢ getOrderDetails</text>
      <text x="40" y="164" font-size="10" font-weight="600" fill="#374151">Boutiques</text>
      <text x="50" y="181" font-size="10" fill="#6b7280">â€¢ getShops (+ distance Haversine)</text>
      <text x="50" y="196" font-size="10" fill="#6b7280">â€¢ getProducts</text>
      <text x="40" y="220" font-size="10" font-weight="600" fill="#374151">Chauffeurs</text>
      <text x="50" y="237" font-size="10" fill="#6b7280">â€¢ updateDriverLocation</text>
      <text x="50" y="252" font-size="10" fill="#6b7280">â€¢ updateDriverStatus</text>
      <text x="40" y="276" font-size="10" font-weight="600" fill="#374151">Autres</text>
      <text x="50" y="293" font-size="10" fill="#6b7280">â€¢ uploadFile</text>
      <text x="50" y="308" font-size="10" fill="#6b7280">â€¢ sendNotification (FCM)</text>
      <text x="50" y="323" font-size="10" fill="#6b7280">â€¢ registerFCMToken</text>
      <text x="50" y="338" font-size="10" fill="#6b7280">â€¢ logMobileEvents (â†’ Loki)</text>

      <!-- Triggers -->
      <rect x="330" y="20" width="240" height="230" rx="12" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
      <text x="450" y="48" text-anchor="middle" font-size="14" font-weight="700" fill="#065f46">Triggers Firestore (4)</text>
      <line x1="350" y1="58" x2="550" y2="58" stroke="#bbf7d0" stroke-width="1"/>
      <text x="350" y="82" font-size="10" fill="#374151">ğŸ“„ <tspan font-weight="600">onOrderCreated</tspan></text>
      <text x="360" y="99" font-size="9" fill="#6b7280">onCreate orders/{id} â†’ timeline + log</text>
      <text x="350" y="122" font-size="10" fill="#374151">ğŸ”„ <tspan font-weight="600">onOrderStatusChange</tspan></text>
      <text x="360" y="139" font-size="9" fill="#6b7280">onUpdate orders/{id} â†’ notifs + release driver</text>
      <text x="350" y="162" font-size="10" fill="#374151">ğŸ“ <tspan font-weight="600">onDriverLocationUpdate</tspan></text>
      <text x="360" y="179" font-size="9" fill="#6b7280">onUpdate drivers/{id} â†’ proximity alert &lt;500m</text>
      <text x="350" y="202" font-size="10" fill="#374151">ğŸ‘¤ <tspan font-weight="600">onUserWriteSyncDriver</tspan></text>
      <text x="360" y="219" font-size="9" fill="#6b7280">onWrite users/{id} â†’ sync drivers collection</text>

      <!-- Scheduled -->
      <rect x="330" y="270" width="240" height="120" rx="12" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
      <text x="450" y="298" text-anchor="middle" font-size="14" font-weight="700" fill="#4c1d95">Scheduled (3)</text>
      <line x1="350" y1="308" x2="550" y2="308" stroke="#c4b5fd" stroke-width="1"/>
      <text x="350" y="332" font-size="10" fill="#374151">â° <tspan font-weight="600">pushMetrics</tspan></text>
      <text x="360" y="349" font-size="9" fill="#6b7280">Chaque 5 min â†’ 30+ mÃ©triques â†’ Grafana</text>
      <text x="350" y="369" font-size="10" fill="#374151">ğŸ”” <tspan font-weight="600">healthCheck</tspan></text>
      <text x="360" y="386" font-size="9" fill="#6b7280">Chaque 5 min â†’ 8 seuils â†’ Discord + FCM</text>

      <!-- Integrations -->
      <rect x="610" y="20" width="230" height="340" rx="12" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1.5"/>
      <text x="725" y="48" text-anchor="middle" font-size="14" font-weight="700" fill="#374151">IntÃ©grations</text>
      <line x1="630" y1="58" x2="820" y2="58" stroke="#d1d5db" stroke-width="1"/>
      <rect x="630" y="70" width="190" height="50" rx="6" fill="#ffedd5" stroke="#f97316" stroke-width="1"/>
      <text x="725" y="92" text-anchor="middle" font-size="11" font-weight="600" fill="#9a3412">Firebase Firestore</text>
      <text x="725" y="108" text-anchor="middle" font-size="9" fill="#6b7280">15 collections Â· batch writes</text>
      <rect x="630" y="130" width="190" height="50" rx="6" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
      <text x="725" y="152" text-anchor="middle" font-size="11" font-weight="600" fill="#991b1b">Firebase Storage</text>
      <text x="725" y="168" text-anchor="middle" font-size="9" fill="#6b7280">Photos livraison Â· Documents KYC</text>
      <rect x="630" y="190" width="190" height="50" rx="6" fill="#cffafe" stroke="#06b6d4" stroke-width="1"/>
      <text x="725" y="212" text-anchor="middle" font-size="11" font-weight="600" fill="#155e75">Firebase FCM</text>
      <text x="725" y="228" text-anchor="middle" font-size="9" fill="#6b7280">Push notifications Â· Token mgmt</text>
      <rect x="630" y="250" width="190" height="50" rx="6" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1"/>
      <text x="725" y="272" text-anchor="middle" font-size="11" font-weight="600" fill="#4c1d95">Grafana Cloud</text>
      <text x="725" y="288" text-anchor="middle" font-size="9" fill="#6b7280">Graphite metrics Â· POST chaque 5m</text>
      <rect x="630" y="310" width="190" height="40" rx="6" fill="#fce7f3" stroke="#ec4899" stroke-width="1"/>
      <text x="725" y="335" text-anchor="middle" font-size="11" font-weight="600" fill="#9d174d">Sentry Â· Error Tracking</text>
      <!-- Arrows -->
      <line x1="300" y1="200" x2="325" y2="130" stroke="#6b7280" stroke-width="1" stroke-dasharray="3" marker-end="url(#a5)"/>
      <line x1="570" y1="130" x2="625" y2="100" stroke="#6b7280" stroke-width="1" stroke-dasharray="3" marker-end="url(#a5)"/>
      <line x1="570" y1="310" x2="625" y2="275" stroke="#6b7280" stroke-width="1" stroke-dasharray="3" marker-end="url(#a5)"/>
    </svg>
  </div>

  <h3>DÃ©tail des Fonctions ClÃ©s</h3>
  <table>
    <thead><tr><th>Fonction</th><th>Type</th><th>DÃ©clencheur</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>createOrder</code></td><td><span class="badge blue">HTTPS</span></td><td>Callable</td><td>CrÃ©er commande : calcul total, rÃ©fÃ©rence ORD-*, prioritÃ©, livraison estimÃ©e 45min</td></tr>
      <tr><td><code>updateOrderStatus</code></td><td><span class="badge blue">HTTPS</span></td><td>Callable</td><td>Changer statut + contrÃ´le permissions (admin/driver/merchant)</td></tr>
      <tr><td><code>getShops</code></td><td><span class="badge blue">HTTPS</span></td><td>Callable</td><td>Lister boutiques actives avec distance Haversine et filtres</td></tr>
      <tr><td><code>updateDriverLocation</code></td><td><span class="badge blue">HTTPS</span></td><td>Callable</td><td>Mise Ã  jour GPS chauffeur (lat, lng, accuracy)</td></tr>
      <tr><td><code>sendNotification</code></td><td><span class="badge blue">HTTPS</span></td><td>Callable</td><td>Push FCM multicast + gestion tokens invalides</td></tr>
      <tr><td><code>uploadFile</code></td><td><span class="badge blue">HTTPS</span></td><td>Callable</td><td>Upload base64 â†’ Storage (photos livraison, signatures, produits)</td></tr>
      <tr><td><code>onOrderCreated</code></td><td><span class="badge green">Trigger</span></td><td>onCreate orders/*</td><td>Initialiser timeline + log d'activitÃ©</td></tr>
      <tr><td><code>onOrderStatusChange</code></td><td><span class="badge green">Trigger</span></td><td>onUpdate orders/*</td><td>Notifications client, libÃ©ration chauffeur si livrÃ©/annulÃ©</td></tr>
      <tr><td><code>onDriverLocationUpdate</code></td><td><span class="badge green">Trigger</span></td><td>onUpdate drivers/*</td><td>Alerte proximitÃ© &lt;500m au client</td></tr>
      <tr><td><code>onUserWriteSyncDriver</code></td><td><span class="badge green">Trigger</span></td><td>onWrite users/*</td><td>Synchroniser users â†” drivers automatiquement</td></tr>
      <tr><td><code>pushMetrics</code></td><td><span class="badge purple">Cron</span></td><td>Chaque 5 min</td><td>30+ mÃ©triques â†’ Grafana Cloud (KPIs, opÃ©rations, funnel)</td></tr>
      <tr><td><code>healthCheck</code></td><td><span class="badge purple">Cron</span></td><td>Chaque 5 min</td><td>8 seuils critiques â†’ Discord + FCM + Firestore notifications</td></tr>
      <tr><td><code>logMobileEvents</code></td><td><span class="badge blue">HTTPS</span></td><td>onRequest</td><td>Batch de logs mobile (auth par API key) â†’ Grafana Loki</td></tr>
    </tbody>
  </table>

  <h3>MÃ©triques PoussÃ©es (pushMetrics â€” 30+)</h3>
  <div class="card-grid">
    <div class="card green"><div class="card-title">Commandes</div><div class="card-desc">total Â· today Â· revenue.total Â· revenue.today Â· status.{each} Â· on_time_rate</div></div>
    <div class="card blue"><div class="card-title">Utilisateurs</div><div class="card-desc">total Â· verified Â· new_today</div></div>
    <div class="card orange"><div class="card-title">Chauffeurs</div><div class="card-desc">total Â· online Â· busy</div></div>
    <div class="card purple"><div class="card-title">VÃ©rifications</div><div class="card-desc">pending Â· approved Â· rejected</div></div>
    <div class="card red"><div class="card-title">Litiges &amp; Boutiques</div><div class="card-desc">disputes.open Â· shops.total</div></div>
    <div class="card cyan"><div class="card-title">OpÃ©rations</div><div class="card-desc">avg_delivery_time Â· active_deliveries Â· delivery_success_rate Â· driver_utilization Â· orders_by_zone.*</div></div>
    <div class="card"><div class="card-title">Funnel</div><div class="card-desc">signup_to_order_rate Â· verification_rate Â· signups_today Â· verifications_today Â· dau Â· wau Â· mau</div></div>
  </div>
</section>

<!-- ========== SECTION 6: FIRESTORE ========== -->
<div class="page-break"></div>
<section id="s6">
  <h2><span class="num">6</span> Base de DonnÃ©es Firestore</h2>
  <p>15 collections Firestore avec listeners temps rÃ©el, rÃ¨gles de sÃ©curitÃ© granulaires et 7 index composites.</p>

  <h3>Diagramme EntitÃ©-Relation</h3>
  <div class="diagram-box">
    <div class="title">Relations entre Collections Firestore</div>
    <svg viewBox="0 0 880 560" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:880px;margin:0 auto;display:block;">
      <defs>
        <marker id="a6" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker>
        <marker id="a6r" markerWidth="8" markerHeight="6" refX="0" refY="3" orient="auto"><polygon points="8 0, 0 3, 8 6" fill="#6b7280"/></marker>
      </defs>
      <!-- users -->
      <rect x="340" y="10" width="200" height="90" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
      <text x="440" y="32" text-anchor="middle" font-size="13" font-weight="700" fill="#065f46">users</text>
      <line x1="360" y1="40" x2="520" y2="40" stroke="#bbf7d0" stroke-width="1"/>
      <text x="360" y="56" font-size="9" fill="#374151">id Â· email Â· name Â· role Â· status</text>
      <text x="360" y="70" font-size="9" fill="#374151">phone Â· avatar Â· shopId?</text>
      <text x="360" y="84" font-size="9" fill="#6b7280">â†’ 5 rÃ´les : admin, supervisor, user, driver, merchant</text>

      <!-- orders -->
      <rect x="340" y="180" width="200" height="110" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
      <text x="440" y="202" text-anchor="middle" font-size="13" font-weight="700" fill="#1e3a8a">orders</text>
      <line x1="360" y1="210" x2="520" y2="210" stroke="#bfdbfe" stroke-width="1"/>
      <text x="360" y="226" font-size="9" fill="#374151">id Â· userId Â· shopId Â· driverId?</text>
      <text x="360" y="240" font-size="9" fill="#374151">status Â· priority Â· total Â· items[]</text>
      <text x="360" y="254" font-size="9" fill="#374151">addresses Â· timeline[] Â· documents[]</text>
      <text x="360" y="268" font-size="9" fill="#6b7280">reference Â· paymentIntentId Â· deliveryCode</text>

      <!-- shops -->
      <rect x="50" y="120" width="180" height="80" rx="8" fill="#ffedd5" stroke="#f97316" stroke-width="2"/>
      <text x="140" y="142" text-anchor="middle" font-size="13" font-weight="700" fill="#9a3412">shops</text>
      <line x1="70" y1="150" x2="210" y2="150" stroke="#fed7aa" stroke-width="1"/>
      <text x="70" y="166" font-size="9" fill="#374151">id Â· name Â· ownerId Â· status</text>
      <text x="70" y="180" font-size="9" fill="#374151">address Â· deliveryFee Â· rating</text>

      <!-- drivers -->
      <rect x="650" y="120" width="200" height="90" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="2"/>
      <text x="750" y="142" text-anchor="middle" font-size="13" font-weight="700" fill="#4c1d95">drivers</text>
      <line x1="670" y1="150" x2="830" y2="150" stroke="#c4b5fd" stroke-width="1"/>
      <text x="670" y="166" font-size="9" fill="#374151">id Â· name Â· email Â· status Â· vehicleType</text>
      <text x="670" y="180" font-size="9" fill="#374151">location{lat,lng} Â· currentOrderId?</text>
      <text x="670" y="194" font-size="9" fill="#374151">rating Â· completedDeliveries</text>

      <!-- products -->
      <rect x="20" y="260" width="170" height="70" rx="8" fill="#cffafe" stroke="#06b6d4" stroke-width="2"/>
      <text x="105" y="282" text-anchor="middle" font-size="13" font-weight="700" fill="#155e75">products</text>
      <line x1="40" y1="290" x2="170" y2="290" stroke="#a5f3fc" stroke-width="1"/>
      <text x="40" y="306" font-size="9" fill="#374151">id Â· shopId Â· name Â· price Â· stock</text>
      <text x="40" y="318" font-size="9" fill="#374151">status Â· sku Â· isRestricted</text>

      <!-- deliveries -->
      <rect x="620" y="270" width="180" height="70" rx="8" fill="#fce7f3" stroke="#ec4899" stroke-width="2"/>
      <text x="710" y="292" text-anchor="middle" font-size="13" font-weight="700" fill="#9d174d">deliveries</text>
      <line x1="640" y1="300" x2="780" y2="300" stroke="#fbcfe8" stroke-width="1"/>
      <text x="640" y="316" font-size="9" fill="#374151">orderId Â· driverId Â· status Â· earnings</text>
      <text x="640" y="328" font-size="9" fill="#374151">shop* Â· customer* coordinates</text>

      <!-- verifications -->
      <rect x="50" y="380" width="170" height="65" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.5"/>
      <text x="135" y="400" text-anchor="middle" font-size="12" font-weight="700" fill="#92400e">verifications</text>
      <line x1="70" y1="408" x2="200" y2="408" stroke="#fde68a" stroke-width="1"/>
      <text x="70" y="424" font-size="9" fill="#374151">userId Â· type Â· status Â· docs</text>
      <text x="70" y="436" font-size="9" fill="#374151">history[] Â· attachments[]</text>

      <!-- disputes -->
      <rect x="260" y="380" width="160" height="55" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
      <text x="340" y="400" text-anchor="middle" font-size="12" font-weight="700" fill="#991b1b">disputes</text>
      <line x1="280" y1="408" x2="400" y2="408" stroke="#fca5a5" stroke-width="1"/>
      <text x="280" y="424" font-size="9" fill="#374151">orderId Â· userId Â· status Â· amount</text>

      <!-- notifications -->
      <rect x="460" y="380" width="160" height="55" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="540" y="400" text-anchor="middle" font-size="12" font-weight="700" fill="#1e3a8a">notifications</text>
      <line x1="480" y1="408" x2="600" y2="408" stroke="#bfdbfe" stroke-width="1"/>
      <text x="480" y="424" font-size="9" fill="#374151">userId Â· type Â· title Â· read</text>

      <!-- activityLogs -->
      <rect x="660" y="380" width="170" height="55" rx="8" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1.5"/>
      <text x="745" y="400" text-anchor="middle" font-size="12" font-weight="700" fill="#374151">activityLogs</text>
      <line x1="680" y1="408" x2="810" y2="408" stroke="#e5e7eb" stroke-width="1"/>
      <text x="680" y="424" font-size="9" fill="#374151">type Â· entityId Â· userId Â· message</text>

      <!-- Other small -->
      <rect x="250" y="490" width="110" height="40" rx="6" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
      <text x="305" y="515" text-anchor="middle" font-size="10" font-weight="600" fill="#374151">reviews</text>
      <rect x="380" y="490" width="110" height="40" rx="6" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
      <text x="435" y="515" text-anchor="middle" font-size="10" font-weight="600" fill="#374151">chats</text>
      <rect x="510" y="490" width="110" height="40" rx="6" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
      <text x="565" y="515" text-anchor="middle" font-size="10" font-weight="600" fill="#374151">config</text>
      <rect x="120" y="490" width="110" height="40" rx="6" fill="#f9fafb" stroke="#d1d5db" stroke-width="1"/>
      <text x="175" y="515" text-anchor="middle" font-size="10" font-weight="600" fill="#374151">legalZones</text>

      <!-- Arrows / Relations -->
      <!-- users â†’ orders (userId) -->
      <line x1="440" y1="100" x2="440" y2="175" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a6)"/>
      <text x="450" y="140" font-size="8" fill="#6b7280">userId</text>
      <!-- users â†’ shops (ownerId) -->
      <path d="M340 70 L230 120" stroke="#6b7280" stroke-width="1" marker-end="url(#a6)"/>
      <text x="270" y="88" font-size="8" fill="#6b7280">ownerId</text>
      <!-- users â†’ drivers (sync) -->
      <path d="M540 50 L650 135" stroke="#8b5cf6" stroke-width="1" stroke-dasharray="4" marker-end="url(#a6)"/>
      <text x="610" y="85" font-size="8" fill="#8b5cf6">sync trigger</text>
      <!-- orders â†’ drivers (driverId) -->
      <path d="M540 220 L650 170" stroke="#6b7280" stroke-width="1" marker-end="url(#a6)"/>
      <text x="600" y="188" font-size="8" fill="#6b7280">driverId</text>
      <!-- orders â†’ shops (shopId) -->
      <path d="M340 230 L230 170" stroke="#6b7280" stroke-width="1" marker-end="url(#a6)"/>
      <text x="270" y="192" font-size="8" fill="#6b7280">shopId</text>
      <!-- shops â†’ products (shopId) -->
      <line x1="105" y1="200" x2="105" y2="255" stroke="#6b7280" stroke-width="1" marker-end="url(#a6)"/>
      <text x="115" y="230" font-size="8" fill="#6b7280">shopId</text>
      <!-- orders â†’ deliveries -->
      <path d="M540 260 L620 285" stroke="#6b7280" stroke-width="1" marker-end="url(#a6)"/>
      <text x="585" y="267" font-size="8" fill="#6b7280">orderId</text>
      <!-- users â†’ verifications -->
      <path d="M340 80 L135 375" stroke="#6b7280" stroke-width="0.8" stroke-dasharray="3" marker-end="url(#a6)"/>
      <!-- users â†’ notifications -->
      <path d="M500 100 L540 375" stroke="#6b7280" stroke-width="0.8" stroke-dasharray="3" marker-end="url(#a6)"/>
      <!-- orders â†’ disputes -->
      <path d="M400 290 L340 375" stroke="#6b7280" stroke-width="0.8" stroke-dasharray="3" marker-end="url(#a6)"/>
    </svg>
  </div>

  <h3>DÃ©tail des Collections Principales</h3>
  <table>
    <thead><tr><th>Collection</th><th>Champs Principaux</th><th>Index Composites</th></tr></thead>
    <tbody>
      <tr><td><strong>users</strong></td><td>id, email, name, role (admin|supervisor|user|driver|merchant), status (pending|verified|rejected), phone?, avatar?, shopId?</td><td>â€”</td></tr>
      <tr><td><strong>orders</strong></td><td>userId, shopId, driverId?, status, priority, total, items[], addresses[], timeline[], documents[], reference, paymentIntentId, deliveryCode</td><td>userId+createdAt, shopId+createdAt, status+createdAt, driverId+status</td></tr>
      <tr><td><strong>shops</strong></td><td>name, ownerId, status, address, deliveryFee, minOrderAmount, rating, categories[], approvalStatus</td><td>â€”</td></tr>
      <tr><td><strong>products</strong></td><td>shopId, name, sku, category, price, stock, status (draft|active|inactive|archived), isRestricted, minimumAge</td><td>â€”</td></tr>
      <tr><td><strong>drivers</strong></td><td>name, email, phone, status (online|offline|busy|break), vehicleType, location{lat,lng,heading,speed,updatedAt}, currentOrderId?, rating</td><td>status+isAvailable</td></tr>
      <tr><td><strong>deliveries</strong></td><td>orderId, driverId, status, earnings, distance, shop* coords, customer* coords, pickedUpAt?, deliveredAt?</td><td>â€”</td></tr>
      <tr><td><strong>verifications</strong></td><td>userId, type (id|license|business), status (pending|approved|rejected), attachments[], history[], firstName, lastName, dateOfBirth</td><td>â€”</td></tr>
      <tr><td><strong>disputes</strong></td><td>orderId, userId, reason, status (open|investigating|resolved|closed), priority, amount, resolution?</td><td>â€”</td></tr>
      <tr><td><strong>notifications</strong></td><td>userId, type, title, message, read, category (user|order|verification|system)</td><td>â€”</td></tr>
      <tr><td><strong>activityLogs</strong></td><td>type, entityType, entityId, userId, message, metadata{}</td><td>entityType+entityId+createdAt</td></tr>
      <tr><td><strong>reviews</strong></td><td>shopId, userId, rating (1-5), comment</td><td>shopId+createdAt</td></tr>
      <tr><td><strong>chats</strong></td><td>messages/{id}: orderId, senderId, senderName, senderRole, content, isRead</td><td>â€”</td></tr>
      <tr><td><strong>config</strong></td><td>platformSettings, deliverySettings, paymentSettings, featureFlags[]</td><td>â€”</td></tr>
      <tr><td><strong>legalZones</strong></td><td>name, type (delivery|restricted), coordinates[], active, color</td><td>â€”</td></tr>
      <tr><td><strong>favorites</strong></td><td>userId, shopId</td><td>â€”</td></tr>
    </tbody>
  </table>
</section>

<!-- ========== SECTION 7: STRIPE ========== -->
<div class="page-break"></div>
<section id="s7">
  <h2><span class="num">7</span> Flux de Paiement Stripe</h2>
  <p>IntÃ©gration complÃ¨te Stripe avec PaymentSheet cÃ´tÃ© mobile, PaymentIntents cÃ´tÃ© serveur, et Stripe Connect pour les paiements marchands et chauffeurs.</p>

  <h3>Cycle de Vie d'un Paiement</h3>
  <div class="diagram-box">
    <div class="title">Flux de Paiement â€” Du Panier Ã  la Livraison</div>
    <svg viewBox="0 0 860 380" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:860px;margin:0 auto;display:block;">
      <defs><marker id="a7" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <!-- Row 1: Client side -->
      <text x="430" y="18" text-anchor="middle" font-size="11" font-weight="700" fill="#6b7280">CÃ”TÃ‰ CLIENT (iOS)</text>
      <rect x="20" y="30" width="150" height="50" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="95" y="52" text-anchor="middle" font-size="11" font-weight="600" fill="#065f46">1. Checkout</text>
      <text x="95" y="68" text-anchor="middle" font-size="9" fill="#6b7280">Panier + adresse + code promo</text>
      <line x1="170" y1="55" x2="195" y2="55" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a7)"/>

      <rect x="200" y="30" width="170" height="50" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="285" y="52" text-anchor="middle" font-size="11" font-weight="600" fill="#1e3a8a">2. preparePayment()</text>
      <text x="285" y="68" text-anchor="middle" font-size="9" fill="#6b7280">POST /payments/create-intent</text>
      <line x1="370" y1="55" x2="395" y2="55" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a7)"/>

      <rect x="400" y="30" width="170" height="50" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="485" y="52" text-anchor="middle" font-size="11" font-weight="600" fill="#4c1d95">3. PaymentSheet</text>
      <text x="485" y="68" text-anchor="middle" font-size="9" fill="#6b7280">Stripe SDK natif iOS</text>
      <line x1="570" y1="55" x2="595" y2="55" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a7)"/>

      <rect x="600" y="30" width="140" height="50" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="670" y="52" text-anchor="middle" font-size="11" font-weight="600" fill="#065f46">4. Confirmation</text>
      <text x="670" y="68" text-anchor="middle" font-size="9" fill="#6b7280">Commande crÃ©Ã©e</text>

      <!-- Row 2: Server side -->
      <text x="430" y="118" text-anchor="middle" font-size="11" font-weight="700" fill="#6b7280">CÃ”TÃ‰ SERVEUR (Vercel + Stripe)</text>
      <rect x="100" y="130" width="200" height="70" rx="8" fill="#ffedd5" stroke="#f97316" stroke-width="1.5"/>
      <text x="200" y="155" text-anchor="middle" font-size="11" font-weight="600" fill="#9a3412">API /payments/create-intent</text>
      <text x="200" y="172" text-anchor="middle" font-size="9" fill="#374151">1. CrÃ©er Stripe Customer</text>
      <text x="200" y="186" text-anchor="middle" font-size="9" fill="#374151">2. CrÃ©er PaymentIntent (amount, currency)</text>

      <line x1="300" y1="165" x2="380" y2="165" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a7)"/>

      <rect x="385" y="130" width="200" height="70" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
      <text x="485" y="155" text-anchor="middle" font-size="11" font-weight="600" fill="#991b1b">Stripe API</text>
      <text x="485" y="172" text-anchor="middle" font-size="9" fill="#374151">PaymentIntent.create()</text>
      <text x="485" y="186" text-anchor="middle" font-size="9" fill="#374151">â†’ clientSecret + ephemeralKey</text>

      <line x1="585" y1="165" x2="630" y2="165" stroke="#6b7280" stroke-width="1.5" marker-end="url(#a7)"/>

      <rect x="635" y="130" width="160" height="70" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="715" y="155" text-anchor="middle" font-size="11" font-weight="600" fill="#1e3a8a">Webhook</text>
      <text x="715" y="172" text-anchor="middle" font-size="9" fill="#374151">payment_intent.succeeded</text>
      <text x="715" y="186" text-anchor="middle" font-size="9" fill="#374151">â†’ Update order status</text>

      <!-- Row 3: Connect -->
      <text x="430" y="238" text-anchor="middle" font-size="11" font-weight="700" fill="#6b7280">STRIPE CONNECT â€” RÃ‰PARTITION DES PAIEMENTS</text>
      <rect x="50" y="250" width="220" height="110" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="160" y="275" text-anchor="middle" font-size="12" font-weight="700" fill="#065f46">Marchand</text>
      <line x1="70" y1="285" x2="250" y2="285" stroke="#bbf7d0" stroke-width="1"/>
      <text x="70" y="305" font-size="10" fill="#374151">ReÃ§oit : montant produits</text>
      <text x="70" y="322" font-size="10" fill="#374151">Stripe Express Dashboard</text>
      <text x="70" y="339" font-size="10" fill="#374151">Onboarding : nom, IBAN, adresse</text>

      <rect x="320" y="250" width="220" height="110" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="430" y="275" text-anchor="middle" font-size="12" font-weight="700" fill="#1e3a8a">Chauffeur</text>
      <line x1="340" y1="285" x2="520" y2="285" stroke="#bfdbfe" stroke-width="1"/>
      <text x="340" y="305" font-size="10" fill="#374151">ReÃ§oit : 80% frais livraison</text>
      <text x="340" y="322" font-size="10" fill="#374151">Stripe Express Dashboard</text>
      <text x="340" y="339" font-size="10" fill="#374151">Onboarding : nom, IBAN, vÃ©hicule</text>

      <rect x="590" y="250" width="220" height="110" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="700" y="275" text-anchor="middle" font-size="12" font-weight="700" fill="#4c1d95">GreenDrop (Plateforme)</text>
      <line x1="610" y1="285" x2="790" y2="285" stroke="#c4b5fd" stroke-width="1"/>
      <text x="610" y="305" font-size="10" fill="#374151">Conserve : 20% frais livraison</text>
      <text x="610" y="322" font-size="10" fill="#374151">Stripe Dashboard principal</text>
      <text x="610" y="339" font-size="10" fill="#374151">Gestion refunds &amp; disputes</text>
    </svg>
  </div>

  <h3>API Routes Paiement</h3>
  <table>
    <thead><tr><th>Route</th><th>MÃ©thode</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>/api/payments/create-intent</code></td><td>POST</td><td>CrÃ©er un PaymentIntent Stripe avec montant, devise, et shopId</td></tr>
      <tr><td><code>/api/payments/webhook</code></td><td>POST</td><td>Webhook Stripe : payment_intent.succeeded â†’ mise Ã  jour commande</td></tr>
      <tr><td><code>/api/payments/connect/onboard</code></td><td>POST</td><td>Onboarding Stripe Connect marchand (Account Link)</td></tr>
      <tr><td><code>/api/payments/connect/driver-onboard</code></td><td>POST</td><td>Onboarding Stripe Connect chauffeur</td></tr>
      <tr><td><code>/api/payments/connect/dashboard</code></td><td>POST</td><td>Lien vers dashboard Express marchand</td></tr>
      <tr><td><code>/api/payments/connect/driver-dashboard</code></td><td>POST</td><td>Lien vers dashboard Express chauffeur</td></tr>
    </tbody>
  </table>
</section>

<!-- ========== SECTION 8: SÃ‰CURITÃ‰ ========== -->
<div class="page-break"></div>
<section id="s8">
  <h2><span class="num">8</span> SÃ©curitÃ© &amp; RÃ¨gles Firestore</h2>

  <h3>ModÃ¨le d'Authentification</h3>
  <div class="diagram-box">
    <div class="title">Architecture de SÃ©curitÃ© Multi-Couche</div>
    <svg viewBox="0 0 800 260" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:800px;margin:0 auto;display:block;">
      <!-- Layer 1 -->
      <rect x="50" y="20" width="700" height="55" rx="10" fill="#fee2e2" stroke="#ef4444" stroke-width="2"/>
      <text x="400" y="42" text-anchor="middle" font-size="13" font-weight="700" fill="#991b1b">Couche 1 â€” Firebase Authentication</text>
      <text x="400" y="60" text-anchor="middle" font-size="10" fill="#374151">Email/Password Â· Google OAuth Â· JWT Tokens Â· Refresh automatique</text>
      <!-- Layer 2 -->
      <rect x="80" y="90" width="640" height="55" rx="10" fill="#ffedd5" stroke="#f97316" stroke-width="2"/>
      <text x="400" y="112" text-anchor="middle" font-size="13" font-weight="700" fill="#9a3412">Couche 2 â€” Firestore Security Rules</text>
      <text x="400" y="130" text-anchor="middle" font-size="10" fill="#374151">isAuthenticated() Â· isAdmin() Â· isOwner() Â· isMerchant() Â· isDriver()</text>
      <!-- Layer 3 -->
      <rect x="110" y="160" width="580" height="55" rx="10" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
      <text x="400" y="182" text-anchor="middle" font-size="13" font-weight="700" fill="#1e3a8a">Couche 3 â€” API Middleware (Next.js)</text>
      <text x="400" y="200" text-anchor="middle" font-size="10" fill="#374151">CSRF Protection Â· Auth Cookie Validation Â· Route Protection Â· Rate Limiting</text>
      <!-- Layer 4 -->
      <rect x="140" y="230" width="520" height="30" rx="6" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="400" y="250" text-anchor="middle" font-size="11" font-weight="600" fill="#065f46">Couche 4 â€” Cloud Functions : Permission Checks (role-based per endpoint)</text>
    </svg>
  </div>

  <h3>Matrice d'AccÃ¨s par Collection</h3>
  <table>
    <thead><tr><th>Collection</th><th>Read</th><th>Create</th><th>Update</th><th>Delete</th></tr></thead>
    <tbody>
      <tr><td><strong>users</strong></td><td>Owner, Admin, Supervisor</td><td>Owner (signup), Admin</td><td>Owner (own fields), Admin</td><td>Admin only</td></tr>
      <tr><td><strong>orders</strong></td><td>Owner, Admin, Supervisor, assigned Driver, shop Merchant</td><td>Authenticated</td><td>Admin, Driver, Merchant, Owner</td><td>Admin only</td></tr>
      <tr><td><strong>shops</strong></td><td>Everyone</td><td>Admin, Merchant</td><td>Admin, Owner</td><td>Admin only</td></tr>
      <tr><td><strong>products</strong></td><td>Everyone</td><td>Admin, Merchant</td><td>Admin, Merchant</td><td>Admin, Merchant</td></tr>
      <tr><td><strong>drivers</strong></td><td>Admin, Supervisor, Owner</td><td>Driver (own), Admin</td><td>Admin, Owner</td><td>Admin only</td></tr>
      <tr><td><strong>verifications</strong></td><td>Admin, Supervisor, Owner</td><td>Authenticated</td><td>Admin only</td><td>Admin only</td></tr>
      <tr><td><strong>disputes</strong></td><td>Admin, Supervisor, Owner, involved Driver</td><td>Authenticated</td><td>Admin, Supervisor</td><td>Admin only</td></tr>
      <tr><td><strong>notifications</strong></td><td>Owner, Admin</td><td>System/Admin</td><td>Owner (mark read)</td><td>Admin only</td></tr>
      <tr><td><strong>activityLogs</strong></td><td>Admin, Supervisor, related User</td><td>Admin only</td><td>Interdit (immutable)</td><td>Interdit</td></tr>
      <tr><td><strong>config</strong></td><td>Everyone</td><td>Admin only</td><td>Admin only</td><td>Admin only</td></tr>
      <tr><td><strong>legalZones</strong></td><td>Everyone</td><td>Admin only</td><td>Admin only</td><td>Admin only</td></tr>
    </tbody>
  </table>
</section>

<!-- ========== SECTION 9: MONITORING ========== -->
<div class="page-break"></div>
<section id="s9">
  <h2><span class="num">9</span> Monitoring &amp; ObservabilitÃ©</h2>

  <h3>Architecture de Monitoring</h3>
  <div class="diagram-box">
    <div class="title">Stack d'ObservabilitÃ©</div>
    <svg viewBox="0 0 900 400" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:900px;margin:0 auto;display:block;">
      <defs><marker id="a9" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <!-- Sources -->
      <rect x="20" y="30" width="160" height="65" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="100" y="52" text-anchor="middle" font-size="11" font-weight="600" fill="#065f46">Mobile iOS</text>
      <text x="100" y="68" text-anchor="middle" font-size="9" fill="#6b7280">LoggingService â†’ Loki</text>
      <text x="100" y="82" text-anchor="middle" font-size="9" fill="#6b7280">Sentry + Crashlytics</text>
      <rect x="20" y="115" width="160" height="65" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="100" y="137" text-anchor="middle" font-size="11" font-weight="600" fill="#1e3a8a">Admin Next.js</text>
      <text x="100" y="153" text-anchor="middle" font-size="9" fill="#6b7280">Winston â†’ Loki</text>
      <text x="100" y="167" text-anchor="middle" font-size="9" fill="#6b7280">@sentry/nextjs</text>
      <rect x="20" y="200" width="160" height="65" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="100" y="222" text-anchor="middle" font-size="11" font-weight="600" fill="#4c1d95">Cloud Functions</text>
      <text x="100" y="238" text-anchor="middle" font-size="9" fill="#6b7280">pushMetrics â†’ Graphite</text>
      <text x="100" y="252" text-anchor="middle" font-size="9" fill="#6b7280">healthCheck â†’ Discord</text>
      <!-- Grafana -->
      <rect x="280" y="30" width="240" height="150" rx="10" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
      <text x="400" y="55" text-anchor="middle" font-size="14" font-weight="700" fill="#92400e">Grafana Cloud</text>
      <line x1="300" y1="65" x2="500" y2="65" stroke="#fde68a" stroke-width="1"/>
      <text x="300" y="85" font-size="10" fill="#374151">Graphite â€” 30+ mÃ©triques business</text>
      <text x="300" y="102" font-size="10" fill="#374151">Loki â€” Logs structurÃ©s (admin + mobile)</text>
      <text x="300" y="119" font-size="10" fill="#374151">5 dashboards (KPI, Ops, Admin, Mobile, Funnel)</text>
      <text x="300" y="136" font-size="10" fill="#374151">12 rÃ¨gles d'alertes configurÃ©es</text>
      <text x="300" y="153" font-size="10" fill="#374151">Page /monitoring dans l'admin</text>
      <!-- Sentry -->
      <rect x="280" y="200" width="240" height="100" rx="10" fill="#fce7f3" stroke="#ec4899" stroke-width="2"/>
      <text x="400" y="225" text-anchor="middle" font-size="14" font-weight="700" fill="#9d174d">Sentry</text>
      <line x1="300" y1="235" x2="500" y2="235" stroke="#fbcfe8" stroke-width="1"/>
      <text x="300" y="255" font-size="10" fill="#374151">Error tracking (admin + functions + mobile)</text>
      <text x="300" y="272" font-size="10" fill="#374151">Performance tracing</text>
      <text x="300" y="289" font-size="10" fill="#374151">Source maps (admin)</text>
      <!-- Outputs -->
      <rect x="630" y="30" width="220" height="55" rx="8" fill="#7c3aed20" stroke="#7c3aed" stroke-width="1.5"/>
      <text x="740" y="52" text-anchor="middle" font-size="11" font-weight="600" fill="#4c1d95">Discord Webhook</text>
      <text x="740" y="72" text-anchor="middle" font-size="9" fill="#6b7280">healthCheck â†’ alertes colorÃ©es</text>
      <rect x="630" y="100" width="220" height="55" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
      <text x="740" y="122" text-anchor="middle" font-size="11" font-weight="600" fill="#991b1b">FCM Push Notifications</text>
      <text x="740" y="142" text-anchor="middle" font-size="9" fill="#6b7280">Alertes critiques â†’ admins</text>
      <rect x="630" y="170" width="220" height="55" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="740" y="192" text-anchor="middle" font-size="11" font-weight="600" fill="#1e3a8a">Firestore Notifications</text>
      <text x="740" y="212" text-anchor="middle" font-size="9" fill="#6b7280">In-app notification center</text>
      <rect x="630" y="240" width="220" height="55" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="740" y="262" text-anchor="middle" font-size="11" font-weight="600" fill="#065f46">Alertes Email Sentry</text>
      <text x="740" y="282" text-anchor="middle" font-size="9" fill="#6b7280">Erreurs critiques</text>
      <!-- Arrows -->
      <line x1="180" y1="62" x2="275" y2="80" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
      <line x1="180" y1="147" x2="275" y2="110" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
      <line x1="180" y1="230" x2="275" y2="140" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
      <line x1="180" y1="62" x2="275" y2="240" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
      <line x1="180" y1="147" x2="275" y2="255" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
      <line x1="520" y1="80" x2="625" y2="57" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
      <line x1="520" y1="100" x2="625" y2="127" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
      <line x1="520" y1="120" x2="625" y2="197" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
      <line x1="520" y1="260" x2="625" y2="267" stroke="#6b7280" stroke-width="1.2" marker-end="url(#a9)"/>
    </svg>
  </div>

  <h3>MÃ©triques Grafana (pushMetrics â€” chaque 5 min)</h3>
  <table>
    <thead><tr><th>MÃ©trique</th><th>ClÃ© Graphite</th><th>Source</th></tr></thead>
    <tbody>
      <tr><td colspan="3" style="background:var(--green-light); font-weight:600;">Business KPIs</td></tr>
      <tr><td>Commandes totales</td><td><code>greendrop.orders.total</code></td><td>orders.count()</td></tr>
      <tr><td>Commandes aujourd'hui</td><td><code>greendrop.orders.today</code></td><td>orders.where(today)</td></tr>
      <tr><td>Revenus total</td><td><code>greendrop.orders.revenue.total</code></td><td>sum(orders.total)</td></tr>
      <tr><td>Revenus aujourd'hui</td><td><code>greendrop.orders.revenue.today</code></td><td>sum(orders.total) today</td></tr>
      <tr><td>Par statut</td><td><code>greendrop.orders.status.{status}</code></td><td>orders.where(status)</td></tr>
      <tr><td>Taux livraison Ã  l'heure</td><td><code>greendrop.orders.on_time_rate</code></td><td>(onTime/delivered)*100</td></tr>
      <tr><td>Utilisateurs total</td><td><code>greendrop.users.total</code></td><td>users.count()</td></tr>
      <tr><td>Utilisateurs vÃ©rifiÃ©s</td><td><code>greendrop.users.verified</code></td><td>users.where(verified)</td></tr>
      <tr><td>Nouveaux aujourd'hui</td><td><code>greendrop.users.new_today</code></td><td>users.where(today)</td></tr>
      <tr><td>Chauffeurs en ligne</td><td><code>greendrop.drivers.online</code></td><td>drivers.where(online)</td></tr>
      <tr><td>Chauffeurs occupÃ©s</td><td><code>greendrop.drivers.busy</code></td><td>drivers.where(busy)</td></tr>
      <tr><td>KYC en attente</td><td><code>greendrop.verifications.pending</code></td><td>verifications.where(pending)</td></tr>
      <tr><td>Litiges ouverts</td><td><code>greendrop.disputes.open</code></td><td>disputes.where(open)</td></tr>
      <tr><td>Boutiques total</td><td><code>greendrop.shops.total</code></td><td>shops.count()</td></tr>
      <tr><td colspan="3" style="background:var(--orange-light); font-weight:600;">OpÃ©rations</td></tr>
      <tr><td>DurÃ©e moyenne livraison</td><td><code>greendrop.operations.avg_delivery_time</code></td><td>(deliveredAt - createdAt) en min</td></tr>
      <tr><td>Livraisons actives</td><td><code>greendrop.operations.active_deliveries</code></td><td>orders.where(shipped)</td></tr>
      <tr><td>Taux succÃ¨s livraison</td><td><code>greendrop.operations.delivery_success_rate</code></td><td>delivered/(delivered+cancelled)*100</td></tr>
      <tr><td>Utilisation chauffeurs</td><td><code>greendrop.operations.driver_utilization</code></td><td>busy/(online+busy)*100</td></tr>
      <tr><td>Commandes par zone</td><td><code>greendrop.operations.orders_by_zone.*</code></td><td>Par ville/zone</td></tr>
      <tr><td colspan="3" style="background:var(--purple-light); font-weight:600;">Funnel Utilisateurs</td></tr>
      <tr><td>Conversion inscriptionâ†’commande</td><td><code>greendrop.funnel.signup_to_order_rate</code></td><td>users avec commande/total*100</td></tr>
      <tr><td>Taux vÃ©rification</td><td><code>greendrop.funnel.verification_rate</code></td><td>verified/total*100</td></tr>
      <tr><td>Inscriptions aujourd'hui</td><td><code>greendrop.funnel.signups_today</code></td><td>users.where(today)</td></tr>
      <tr><td>VÃ©rifications aujourd'hui</td><td><code>greendrop.funnel.verifications_today</code></td><td>verifications.where(approved, today)</td></tr>
      <tr><td>DAU</td><td><code>greendrop.funnel.dau</code></td><td>Users actifs 24h</td></tr>
      <tr><td>WAU</td><td><code>greendrop.funnel.wau</code></td><td>Users actifs 7 jours</td></tr>
      <tr><td>MAU</td><td><code>greendrop.funnel.mau</code></td><td>Users actifs 30 jours</td></tr>
    </tbody>
  </table>

  <h3>Dashboards Grafana (5)</h3>
  <div class="card-grid">
    <div class="card green"><div class="card-title">ğŸ“Š Business KPIs</div><div class="card-desc">Commandes, revenus, utilisateurs, chauffeurs, vÃ©rifications. Source : Graphite.</div></div>
    <div class="card orange"><div class="card-title">ğŸšš Operations</div><div class="card-desc">DurÃ©e livraison, utilisation chauffeurs, commandes par zone/statut, taux on-time. Source : Graphite.</div></div>
    <div class="card blue"><div class="card-title">ğŸ–¥ï¸ Admin Performance</div><div class="card-desc">Page views, latence API p50/p95/p99, taux d'erreurs, top pages, endpoints lents. Source : Loki.</div></div>
    <div class="card purple"><div class="card-title">ğŸ“± Mobile</div><div class="card-desc">Lancements, sessions, erreurs API, latence, versions, logs live. Source : Loki (via logMobileEvents).</div></div>
    <div class="card cyan"><div class="card-title">ğŸ‘¥ User Funnel</div><div class="card-desc">DAU/WAU/MAU, inscriptions, taux vÃ©rification, conversion inscriptionâ†’commande. Source : Graphite.</div></div>
  </div>

  <h3>Health Check Automatique (healthCheck â€” chaque 5 min)</h3>
  <p>Cloud Function planifiÃ©e qui vÃ©rifie 8 seuils critiques et envoie des alertes multi-canal avec dÃ©duplication (30 min de cooldown via collection <code>alertHistory</code>).</p>
  <table>
    <thead><tr><th>VÃ©rification</th><th>Seuil</th><th>SÃ©vÃ©ritÃ©</th></tr></thead>
    <tbody>
      <tr><td>Aucun chauffeur en ligne</td><td>online = 0 pendant 10 min</td><td><span class="badge red">Critical</span></td></tr>
      <tr><td>Surcharge chauffeurs</td><td>utilisation > 90%</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Litiges ouverts</td><td>> 10 disputes ouvertes</td><td><span class="badge red">Critical</span></td></tr>
      <tr><td>KYC backlog</td><td>> 20 vÃ©rifications en attente</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Taux de livraison</td><td>< 80% de livraisons Ã  temps</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Revenu journalier</td><td>0â‚¬ aprÃ¨s 12h</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Commandes bloquÃ©es</td><td>Shipped depuis > 2h</td><td><span class="badge red">Critical</span></td></tr>
      <tr><td>Inscriptions</td><td>0 inscriptions depuis 18h</td><td><span class="badge orange">Warning</span></td></tr>
    </tbody>
  </table>
  <h4>Canaux d'alerte</h4>
  <div class="flow">
    <div class="flow-step purple">healthCheck</div>
    <span class="flow-arrow">â†’</span>
    <div class="flow-step blue">Discord Webhook</div>
    <span class="flow-arrow">â†’</span>
    <div class="flow-step orange">FCM Push (admins)</div>
    <span class="flow-arrow">â†’</span>
    <div class="flow-step">Firestore notifications</div>
  </div>

  <h3>Mobile Logging (LoggingService)</h3>
  <p>Singleton iOS qui bufferise les Ã©vÃ©nements (max 20) et les envoie toutes les 30s vers la Cloud Function <code>logMobileEvents</code>, qui les pousse vers Loki avec le label <code>app: "greendrop-mobile"</code>.</p>
  <table>
    <thead><tr><th>Ã‰vÃ©nement</th><th>DonnÃ©es</th></tr></thead>
    <tbody>
      <tr><td><code>screen_view</code></td><td>Nom de l'Ã©cran (Home, DriverDashboard, MerchantDashboard...)</td></tr>
      <tr><td><code>api_call</code></td><td>Endpoint, mÃ©thode, durÃ©e (ms), status code</td></tr>
      <tr><td><code>order_started / order_placed / order_error</code></td><td>Flux commande complet</td></tr>
      <tr><td><code>login_success / login_failure</code></td><td>MÃ©thode (email/google), erreur Ã©ventuelle</td></tr>
      <tr><td><code>app_launch</code></td><td>Version, OS, device</td></tr>
    </tbody>
  </table>

  <h3>Alertes Grafana (12 rÃ¨gles)</h3>
  <table>
    <thead><tr><th>Alerte</th><th>Seuil</th><th>Source</th><th>SÃ©vÃ©ritÃ©</th></tr></thead>
    <tbody>
      <tr><td>Taux livraison bas</td><td>&lt; 80%</td><td>Graphite</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Disputes ouvertes</td><td>&gt; 10</td><td>Graphite</td><td><span class="badge red">Critical</span></td></tr>
      <tr><td>KYC backlog</td><td>&gt; 20</td><td>Graphite</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Aucun chauffeur</td><td>= 0</td><td>Graphite</td><td><span class="badge red">Critical</span></td></tr>
      <tr><td>Taux erreur API</td><td>&gt; 10%</td><td>Loki</td><td><span class="badge red">Critical</span></td></tr>
      <tr><td>Latence API</td><td>&gt; 2000ms</td><td>Loki</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Erreurs mobile</td><td>&gt; 1%</td><td>Loki</td><td><span class="badge red">Critical</span></td></tr>
      <tr><td>Erreur API admin</td><td>&gt; 5%</td><td>Loki</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Aucune inscription 24h</td><td>= 0</td><td>Graphite</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Chauffeurs surchargÃ©s</td><td>&gt; 90%</td><td>Graphite</td><td><span class="badge orange">Warning</span></td></tr>
      <tr><td>Pic trafic admin</td><td>&gt; 50 sessions/5min</td><td>Loki</td><td><span class="badge blue">Info</span></td></tr>
      <tr><td>Revenu = 0â‚¬ aprÃ¨s 12h</td><td>&lt; 1â‚¬</td><td>Graphite</td><td><span class="badge orange">Warning</span></td></tr>
    </tbody>
  </table>
</section>

<!-- ========== SECTION 10: CI/CD ========== -->
<div class="page-break"></div>
<section id="s10">
  <h2><span class="num">10</span> CI/CD Pipeline</h2>
  <p>Pipeline GitHub Actions avec 7 jobs parallÃ©lisÃ©s, dÃ©clenchÃ©e sur push/PR vers main et develop.</p>

  <h3>Pipeline CI</h3>
  <div class="diagram-box">
    <div class="title">GitHub Actions â€” Workflow CI</div>
    <svg viewBox="0 0 860 340" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:860px;margin:0 auto;display:block;">
      <defs><marker id="a10" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <!-- Trigger -->
      <rect x="330" y="10" width="200" height="40" rx="8" fill="#f3f4f6" stroke="#374151" stroke-width="2"/>
      <text x="430" y="35" text-anchor="middle" font-size="12" font-weight="700" fill="#111827">Push / PR â†’ main, develop</text>
      <line x1="430" y1="50" x2="430" y2="70" stroke="#374151" stroke-width="1.5"/>
      <line x1="160" y1="70" x2="700" y2="70" stroke="#374151" stroke-width="1.5"/>
      <!-- Admin Parallel -->
      <text x="300" y="94" text-anchor="middle" font-size="10" font-weight="700" fill="#3b82f6">ADMIN</text>
      <!-- Lint -->
      <line x1="160" y1="70" x2="160" y2="105" stroke="#374151" stroke-width="1"/>
      <rect x="80" y="105" width="160" height="45" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="160" y="125" text-anchor="middle" font-size="11" font-weight="600" fill="#1e3a8a">Admin Â· Lint</text>
      <text x="160" y="140" text-anchor="middle" font-size="9" fill="#6b7280">pnpm lint (ESLint)</text>
      <!-- TypeCheck -->
      <line x1="350" y1="70" x2="350" y2="105" stroke="#374151" stroke-width="1"/>
      <rect x="270" y="105" width="160" height="45" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="350" y="125" text-anchor="middle" font-size="11" font-weight="600" fill="#1e3a8a">Admin Â· Type Check</text>
      <text x="350" y="140" text-anchor="middle" font-size="9" fill="#6b7280">tsc --noEmit</text>
      <!-- Security -->
      <line x1="510" y1="70" x2="510" y2="105" stroke="#374151" stroke-width="1"/>
      <rect x="440" y="105" width="140" height="45" rx="8" fill="#fee2e2" stroke="#ef4444" stroke-width="1.5"/>
      <text x="510" y="125" text-anchor="middle" font-size="11" font-weight="600" fill="#991b1b">Admin Â· Security</text>
      <text x="510" y="140" text-anchor="middle" font-size="9" fill="#6b7280">pnpm audit --high</text>
      <!-- Functions Lint -->
      <text x="700" y="94" text-anchor="middle" font-size="10" font-weight="700" fill="#8b5cf6">FUNCTIONS</text>
      <line x1="700" y1="70" x2="700" y2="105" stroke="#374151" stroke-width="1"/>
      <rect x="620" y="105" width="160" height="45" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="700" y="125" text-anchor="middle" font-size="11" font-weight="600" fill="#4c1d95">Functions Â· Lint</text>
      <text x="700" y="140" text-anchor="middle" font-size="9" fill="#6b7280">pnpm lint</text>
      <!-- Needs: Admin Test -->
      <line x1="160" y1="150" x2="160" y2="175" stroke="#374151" stroke-width="1" marker-end="url(#a10)"/>
      <line x1="350" y1="150" x2="250" y2="175" stroke="#374151" stroke-width="1" stroke-dasharray="3"/>
      <rect x="80" y="180" width="160" height="45" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="160" y="200" text-anchor="middle" font-size="11" font-weight="600" fill="#065f46">Admin Â· Test</text>
      <text x="160" y="215" text-anchor="middle" font-size="9" fill="#6b7280">pnpm test (Vitest)</text>
      <text x="250" y="172" font-size="8" fill="#6b7280">needs: lint + typecheck</text>
      <!-- Needs: Admin Build -->
      <line x1="350" y1="150" x2="350" y2="175" stroke="#374151" stroke-width="1" marker-end="url(#a10)"/>
      <line x1="160" y1="150" x2="280" y2="175" stroke="#374151" stroke-width="1" stroke-dasharray="3"/>
      <rect x="270" y="180" width="160" height="45" rx="8" fill="#ffedd5" stroke="#f97316" stroke-width="1.5"/>
      <text x="350" y="200" text-anchor="middle" font-size="11" font-weight="600" fill="#9a3412">Admin Â· Build</text>
      <text x="350" y="215" text-anchor="middle" font-size="9" fill="#6b7280">pnpm build (Next.js)</text>
      <!-- Needs: Functions Build -->
      <line x1="700" y1="150" x2="700" y2="175" stroke="#374151" stroke-width="1" marker-end="url(#a10)"/>
      <rect x="620" y="180" width="160" height="45" rx="8" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="700" y="200" text-anchor="middle" font-size="11" font-weight="600" fill="#4c1d95">Functions Â· Build</text>
      <text x="700" y="215" text-anchor="middle" font-size="9" fill="#6b7280">pnpm build (TypeScript)</text>
      <!-- Summary -->
      <line x1="160" y1="225" x2="160" y2="260" stroke="#22c55e" stroke-width="1"/>
      <line x1="350" y1="225" x2="350" y2="260" stroke="#22c55e" stroke-width="1"/>
      <line x1="700" y1="225" x2="700" y2="260" stroke="#22c55e" stroke-width="1"/>
      <line x1="160" y1="260" x2="700" y2="260" stroke="#22c55e" stroke-width="1.5"/>
      <line x1="430" y1="260" x2="430" y2="280" stroke="#22c55e" stroke-width="1.5" marker-end="url(#a10)"/>
      <rect x="330" y="285" width="200" height="40" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
      <text x="430" y="310" text-anchor="middle" font-size="13" font-weight="700" fill="#065f46">âœ“ Pipeline OK</text>
    </svg>
  </div>

  <h3>Configuration des Jobs</h3>
  <table>
    <thead><tr><th>Job</th><th>DÃ©pendances</th><th>Commande</th><th>Env Variables</th></tr></thead>
    <tbody>
      <tr><td>Admin Â· Lint</td><td>â€”</td><td><code>pnpm lint</code></td><td>â€”</td></tr>
      <tr><td>Admin Â· Type Check</td><td>â€”</td><td><code>pnpm exec tsc --noEmit</code></td><td>â€”</td></tr>
      <tr><td>Admin Â· Security</td><td>â€”</td><td><code>pnpm audit --audit-level=high</code></td><td>â€”</td></tr>
      <tr><td>Admin Â· Test</td><td>Lint + TypeCheck</td><td><code>pnpm test</code></td><td>FIREBASE_PROJECT_ID, STRIPE_SECRET_KEY</td></tr>
      <tr><td>Admin Â· Build</td><td>Lint + TypeCheck</td><td><code>pnpm build</code></td><td>FIREBASE_*, SENTRY_*, STRIPE_*</td></tr>
      <tr><td>Functions Â· Lint</td><td>â€”</td><td><code>pnpm lint</code></td><td>â€”</td></tr>
      <tr><td>Functions Â· Build</td><td>Functions Lint</td><td><code>pnpm build</code></td><td>â€”</td></tr>
    </tbody>
  </table>

  <h3>DÃ©ploiement</h3>
  <div class="card-grid">
    <div class="card blue"><div class="card-title">Admin â†’ Vercel</div><div class="card-desc">DÃ©ploiement automatique via intÃ©gration GitHub. Preview sur PR, production sur main.</div></div>
    <div class="card purple"><div class="card-title">Functions â†’ Firebase</div><div class="card-desc">DÃ©ploiement manuel : <code>firebase deploy --only functions</code> depuis shared/functions/</div></div>
    <div class="card orange"><div class="card-title">Firestore Rules</div><div class="card-desc">DÃ©ploiement manuel : <code>firebase deploy --only firestore:rules</code> depuis shared/</div></div>
  </div>

  <h3>QualitÃ© de Code</h3>
  <div class="card-grid">
    <div class="card"><div class="card-title">ESLint</div><div class="card-desc">Linting TypeScript/React avec config Next.js</div></div>
    <div class="card"><div class="card-title">TypeScript strict</div><div class="card-desc">tsc --noEmit vÃ©rification types sans build</div></div>
    <div class="card"><div class="card-title">Husky pre-commit</div><div class="card-desc">ExÃ©cute <code>pnpm test</code> avant chaque commit</div></div>
    <div class="card"><div class="card-title">Vitest</div><div class="card-desc">Tests unitaires pour services et utilitaires</div></div>
  </div>
</section>

<!-- ========== SECTION 11: API ========== -->
<div class="page-break"></div>
<section id="s11">
  <h2><span class="num">11</span> API REST Documentation</h2>
  <p>API REST hÃ©bergÃ©e sur Vercel via les API Routes Next.js. Base URL : <code>https://greendrop-one.vercel.app/api</code></p>

  <h3>Endpoints</h3>
  <table>
    <thead><tr><th>Route</th><th>MÃ©thode</th><th>Auth</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td colspan="4" style="background:#dcfce7;font-weight:600;">Commandes</td></tr>
      <tr><td><code>/api/orders</code></td><td>GET</td><td>Bearer</td><td>Lister toutes les commandes (admin)</td></tr>
      <tr><td><code>/api/orders</code></td><td>POST</td><td>Bearer</td><td>CrÃ©er une commande</td></tr>
      <tr><td><code>/api/orders/my</code></td><td>GET</td><td>Bearer</td><td>Mes commandes (filtrable par status)</td></tr>
      <tr><td><code>/api/orders/[id]</code></td><td>GET</td><td>Bearer</td><td>DÃ©tail d'une commande</td></tr>
      <tr><td><code>/api/orders/[id]</code></td><td>PATCH</td><td>Bearer</td><td>Mettre Ã  jour statut/driver</td></tr>
      <tr><td><code>/api/orders/[id]</code></td><td>DELETE</td><td>Bearer</td><td>Supprimer commande (admin)</td></tr>
      <tr><td colspan="4" style="background:#dbeafe;font-weight:600;">Chauffeurs</td></tr>
      <tr><td><code>/api/drivers/location</code></td><td>POST</td><td>Bearer</td><td>Mettre Ã  jour position GPS</td></tr>
      <tr><td><code>/api/drivers/status</code></td><td>POST</td><td>Bearer</td><td>Changer statut (online/offline/busy)</td></tr>
      <tr><td colspan="4" style="background:#ffedd5;font-weight:600;">Boutiques &amp; Produits</td></tr>
      <tr><td><code>/api/shops</code></td><td>GET</td><td>â€”</td><td>Lister boutiques (filtres: catÃ©gorie, search, geo)</td></tr>
      <tr><td><code>/api/shops/[id]/products</code></td><td>GET</td><td>â€”</td><td>Produits d'une boutique</td></tr>
      <tr><td colspan="4" style="background:#ede9fe;font-weight:600;">Paiements</td></tr>
      <tr><td><code>/api/payments/create-intent</code></td><td>POST</td><td>Bearer</td><td>CrÃ©er PaymentIntent Stripe</td></tr>
      <tr><td><code>/api/payments/webhook</code></td><td>POST</td><td>Stripe Sig</td><td>Webhook payment_intent.succeeded</td></tr>
      <tr><td><code>/api/payments/connect/onboard</code></td><td>POST</td><td>Bearer</td><td>Onboarding Stripe Connect marchand</td></tr>
      <tr><td><code>/api/payments/connect/driver-onboard</code></td><td>POST</td><td>Bearer</td><td>Onboarding Stripe Connect chauffeur</td></tr>
      <tr><td><code>/api/payments/connect/dashboard</code></td><td>POST</td><td>Bearer</td><td>Dashboard Express marchand</td></tr>
      <tr><td><code>/api/payments/connect/driver-dashboard</code></td><td>POST</td><td>Bearer</td><td>Dashboard Express chauffeur</td></tr>
      <tr><td colspan="4" style="background:#f3f4f6;font-weight:600;">Autres</td></tr>
      <tr><td><code>/api/users/export</code></td><td>GET</td><td>Bearer</td><td>Export RGPD donnÃ©es utilisateur (CSV)</td></tr>
      <tr><td><code>/api/notifications</code></td><td>GET/POST</td><td>Bearer</td><td>Notifications utilisateur</td></tr>
      <tr><td><code>/api/reviews</code></td><td>GET/POST</td><td>Bearer</td><td>Avis boutique/chauffeur</td></tr>
      <tr><td><code>/api/upload</code></td><td>POST</td><td>Bearer</td><td>Upload fichier vers Storage</td></tr>
      <tr><td><code>/api/csrf</code></td><td>POST</td><td>â€”</td><td>Obtenir token CSRF</td></tr>
      <tr><td><code>/api/openapi</code></td><td>GET</td><td>â€”</td><td>SpÃ©cification OpenAPI</td></tr>
    </tbody>
  </table>

  <h3>Cycle de Vie d'une Commande</h3>
  <div class="diagram-box">
    <div class="title">Statuts de Commande</div>
    <svg viewBox="0 0 800 100" xmlns="http://www.w3.org/2000/svg" style="width:100%;max-width:800px;margin:0 auto;display:block;">
      <defs><marker id="a11" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto"><polygon points="0 0, 8 3, 0 6" fill="#6b7280"/></marker></defs>
      <rect x="10" y="30" width="80" height="35" rx="6" fill="#f3f4f6" stroke="#d1d5db" stroke-width="1.5"/>
      <text x="50" y="52" text-anchor="middle" font-size="10" font-weight="600" fill="#374151">created</text>
      <line x1="90" y1="47" x2="110" y2="47" stroke="#6b7280" stroke-width="1" marker-end="url(#a11)"/>
      <rect x="115" y="30" width="70" height="35" rx="6" fill="#dcfce7" stroke="#16a34a" stroke-width="1.5"/>
      <text x="150" y="52" text-anchor="middle" font-size="10" font-weight="600" fill="#065f46">paid</text>
      <line x1="185" y1="47" x2="210" y2="47" stroke="#6b7280" stroke-width="1" marker-end="url(#a11)"/>
      <rect x="215" y="30" width="90" height="35" rx="6" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.5"/>
      <text x="260" y="52" text-anchor="middle" font-size="10" font-weight="600" fill="#1e3a8a">confirmed</text>
      <line x1="305" y1="47" x2="325" y2="47" stroke="#6b7280" stroke-width="1" marker-end="url(#a11)"/>
      <rect x="330" y="30" width="90" height="35" rx="6" fill="#ede9fe" stroke="#8b5cf6" stroke-width="1.5"/>
      <text x="375" y="52" text-anchor="middle" font-size="10" font-weight="600" fill="#4c1d95">preparing</text>
      <line x1="420" y1="47" x2="440" y2="47" stroke="#6b7280" stroke-width="1" marker-end="url(#a11)"/>
      <rect x="445" y="30" width="70" height="35" rx="6" fill="#ffedd5" stroke="#f97316" stroke-width="1.5"/>
      <text x="480" y="52" text-anchor="middle" font-size="10" font-weight="600" fill="#9a3412">ready</text>
      <line x1="515" y1="47" x2="540" y2="47" stroke="#6b7280" stroke-width="1" marker-end="url(#a11)"/>
      <rect x="545" y="30" width="90" height="35" rx="6" fill="#cffafe" stroke="#06b6d4" stroke-width="1.5"/>
      <text x="590" y="52" text-anchor="middle" font-size="10" font-weight="600" fill="#155e75">delivering</text>
      <line x1="635" y1="47" x2="660" y2="47" stroke="#6b7280" stroke-width="1" marker-end="url(#a11)"/>
      <rect x="665" y="30" width="90" height="35" rx="6" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
      <text x="710" y="52" text-anchor="middle" font-size="10" font-weight="700" fill="#065f46">delivered</text>
      <!-- Cancelled branch -->
      <rect x="350" y="78" width="90" height="22" rx="4" fill="#fee2e2" stroke="#ef4444" stroke-width="1"/>
      <text x="395" y="93" text-anchor="middle" font-size="9" font-weight="600" fill="#991b1b">cancelled</text>
      <text x="320" y="90" font-size="8" fill="#ef4444">â†— (Ã  tout moment)</text>
    </svg>
  </div>
</section>

<!-- ========== SECTION 12: ENV VARS ========== -->
<div class="page-break"></div>
<section id="s12">
  <h2><span class="num">12</span> Variables d'Environnement</h2>

  <h3>Admin (.env.local)</h3>
  <table>
    <thead><tr><th>Variable</th><th>Description</th><th>Exemple</th></tr></thead>
    <tbody>
      <tr><td><code>NEXT_PUBLIC_FIREBASE_API_KEY</code></td><td>ClÃ© API Firebase</td><td>AIzaSy...</td></tr>
      <tr><td><code>NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN</code></td><td>Domaine Auth Firebase</td><td>project.firebaseapp.com</td></tr>
      <tr><td><code>NEXT_PUBLIC_FIREBASE_PROJECT_ID</code></td><td>ID projet Firebase</td><td>greendrop-xxxxx</td></tr>
      <tr><td><code>NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET</code></td><td>Bucket Storage</td><td>project.appspot.com</td></tr>
      <tr><td><code>NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID</code></td><td>Sender ID FCM</td><td>895666623258</td></tr>
      <tr><td><code>NEXT_PUBLIC_FIREBASE_APP_ID</code></td><td>App ID Firebase</td><td>1:895...</td></tr>
      <tr><td><code>NEXT_PUBLIC_SENTRY_DSN</code></td><td>DSN Sentry pour error tracking</td><td>https://xxx@sentry.io/xxx</td></tr>
      <tr><td><code>SENTRY_ORG</code></td><td>Organisation Sentry</td><td>greendrop</td></tr>
      <tr><td><code>SENTRY_PROJECT</code></td><td>Projet Sentry</td><td>admin</td></tr>
      <tr><td><code>SENTRY_AUTH_TOKEN</code></td><td>Token Sentry (source maps)</td><td>sntrys_...</td></tr>
      <tr><td><code>STRIPE_SECRET_KEY</code></td><td>ClÃ© secrÃ¨te Stripe</td><td>sk_live_...</td></tr>
      <tr><td><code>STRIPE_WEBHOOK_SECRET</code></td><td>Secret webhook Stripe</td><td>whsec_...</td></tr>
      <tr><td><code>NEXT_PUBLIC_GRAFANA_PUBLIC_KPI</code></td><td>URL public dashboard KPIs</td><td>https://xxx.grafana.net/public-dashboards/...</td></tr>
      <tr><td><code>NEXT_PUBLIC_GRAFANA_PUBLIC_OPERATIONS</code></td><td>URL public dashboard Ops</td><td>https://xxx.grafana.net/public-dashboards/...</td></tr>
      <tr><td><code>NEXT_PUBLIC_GRAFANA_PUBLIC_ADMIN</code></td><td>URL public dashboard Admin</td><td>https://xxx.grafana.net/public-dashboards/...</td></tr>
      <tr><td><code>NEXT_PUBLIC_GRAFANA_PUBLIC_MOBILE</code></td><td>URL public dashboard Mobile</td><td>https://xxx.grafana.net/public-dashboards/...</td></tr>
      <tr><td><code>NEXT_PUBLIC_GRAFANA_PUBLIC_FUNNEL</code></td><td>URL public dashboard Funnel</td><td>https://xxx.grafana.net/public-dashboards/...</td></tr>
    </tbody>
  </table>

  <h3>Cloud Functions (.env)</h3>
  <table>
    <thead><tr><th>Variable</th><th>Description</th></tr></thead>
    <tbody>
      <tr><td><code>GRAFANA_URL</code></td><td>Endpoint Graphite Grafana Cloud</td></tr>
      <tr><td><code>GRAFANA_USER</code></td><td>User ID Grafana Cloud</td></tr>
      <tr><td><code>GRAFANA_API_KEY</code></td><td>ClÃ© API Grafana (scope: metrics write)</td></tr>
      <tr><td><code>LOKI_HOST</code></td><td>Endpoint Loki Grafana Cloud</td></tr>
      <tr><td><code>LOKI_USER_ID</code></td><td>User ID Loki</td></tr>
      <tr><td><code>GRAFANA_LOKI_TOKEN</code></td><td>Token API Loki</td></tr>
      <tr><td><code>SENTRY_DSN</code></td><td>DSN Sentry pour Cloud Functions</td></tr>
      <tr><td><code>MOBILE_LOG_API_KEY</code></td><td>ClÃ© API pour l'endpoint logMobileEvents</td></tr>
      <tr><td><code>DISCORD_WEBHOOK_URL</code></td><td>URL webhook Discord pour les alertes healthCheck</td></tr>
    </tbody>
  </table>

  <h3>CI/CD (GitHub Secrets)</h3>
  <table>
    <thead><tr><th>Secret</th><th>UtilisÃ© par</th></tr></thead>
    <tbody>
      <tr><td><code>NEXT_PUBLIC_FIREBASE_*</code> (6 vars)</td><td>Admin Build job</td></tr>
      <tr><td><code>NEXT_PUBLIC_SENTRY_DSN</code></td><td>Admin Build job</td></tr>
      <tr><td><code>SENTRY_ORG / SENTRY_PROJECT / SENTRY_AUTH_TOKEN</code></td><td>Admin Build (source maps upload)</td></tr>
      <tr><td><code>STRIPE_SECRET_KEY / STRIPE_WEBHOOK_SECRET</code></td><td>Admin Build + Test jobs</td></tr>
      <tr><td><code>FIREBASE_PROJECT_ID</code></td><td>Admin Test job</td></tr>
    </tbody>
  </table>
</section>

<!-- ========== FOOTER ========== -->
<div class="page-break"></div>
<section style="text-align:center; padding: 60px 0;">
  <div style="font-size:50px; margin-bottom:20px;">ğŸŒ¿</div>
  <h2 style="justify-content:center; border:none;">GreenDrop â€” Documentation Technique</h2>
  <p style="color:var(--gray-500); font-size:14px; margin-top:10px;">
    Plateforme de livraison CBD<br>
    Application Mobile iOS Â· Panel Admin Web Â· Cloud Functions Firebase<br>
    ~18 600 lignes Swift Â· Next.js 16 Â· 22 Cloud Functions Â· 5 Dashboards Grafana<br><br>
    <strong>Projet RNCP â€” FÃ©vrier 2026</strong>
  </p>
</section>
</div>

</body>
</html>